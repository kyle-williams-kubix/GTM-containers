{
    "exportFormatVersion": 2,
    "exportTime": "2025-01-24 11:46:33",
    "containerVersion": {
        "path": "accounts/6246124678/containers/193445853/versions/0",
        "accountId": "6246124678",
        "containerId": "193445853",
        "containerVersionId": "0",
        "container": {
            "path": "accounts/6246124678/containers/193445853",
            "accountId": "6246124678",
            "containerId": "193445853",
            "name": "TEST STORE",
            "publicId": "GTM-W5Q9C9NX",
            "usageContext": [
                "WEB"
            ],
            "fingerprint": "1727956700216",
            "tagManagerUrl": "https://tagmanager.google.com/#/container/accounts/6246124678/containers/193445853/workspaces?apiLink=container",
            "features": {
                "supportUserPermissions": true,
                "supportEnvironments": true,
                "supportWorkspaces": true,
                "supportGtagConfigs": false,
                "supportBuiltInVariables": true,
                "supportClients": false,
                "supportFolders": true,
                "supportTags": true,
                "supportTemplates": true,
                "supportTriggers": true,
                "supportVariables": true,
                "supportVersions": true,
                "supportZones": true,
                "supportTransformations": false
            },
            "tagIds": [
                "GTM-W5Q9C9NX"
            ]
        },
        "tag": [
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "tagId": "264",
                "name": "[KBX] GA4 - returning_customer_purchase",
                "type": "gaawe",
                "parameter": [
                    {
                        "type": "TEMPLATE",
                        "key": "userDataVariable",
                        "value": "{{ga4 - user_provided_data}}"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "sendEcommerceData",
                        "value": "false"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "enhancedUserId",
                        "value": "true"
                    },
                    {
                        "type": "LIST",
                        "key": "eventSettingsTable",
                        "list": [
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameter",
                                        "value": "currency"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameterValue",
                                        "value": "{{dlv - ecommerce.currency}}"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameter",
                                        "value": "value"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameterValue",
                                        "value": "{{dlv - ecommerce.value}}"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameter",
                                        "value": "transaction_id"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameterValue",
                                        "value": "{{dlv - ecommerce.transaction_id}}"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameter",
                                        "value": "coupon"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameterValue",
                                        "value": "{{dlv - ecommerce.coupon}}"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameter",
                                        "value": "shipping"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameterValue",
                                        "value": "{{dlv - ecommerce.shipping}}"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameter",
                                        "value": "tax"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameterValue",
                                        "value": "{{dlv - ecommerce.tax}}"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameter",
                                        "value": "items"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameterValue",
                                        "value": "{{dlv - ecommerce.items}}"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameter",
                                        "value": "user_data"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameterValue",
                                        "value": "{{ga4 - user_provided_data}}"
                                    }
                                ]
                            }
                        ]
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "eventName",
                        "value": "returning_customer_purchase"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "measurementIdOverride",
                        "value": "{{const - ga4 measurement id}}"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "eventSettingsVariable",
                        "value": "{{ga4 - shared_event_settings}}"
                    }
                ],
                "fingerprint": "1737718470805",
                "firingTriggerId": [
                    "263"
                ],
                "parentFolderId": "100",
                "tagFiringOption": "ONCE_PER_EVENT",
                "monitoringMetadata": {
                    "type": "MAP"
                },
                "consentSettings": {
                    "consentStatus": "NOT_NEEDED"
                }
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "tagId": "267",
                "name": "[KBX] GA4 - new_customer_purchase",
                "type": "gaawe",
                "parameter": [
                    {
                        "type": "TEMPLATE",
                        "key": "userDataVariable",
                        "value": "{{ga4 - user_provided_data}}"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "sendEcommerceData",
                        "value": "false"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "enhancedUserId",
                        "value": "true"
                    },
                    {
                        "type": "LIST",
                        "key": "eventSettingsTable",
                        "list": [
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameter",
                                        "value": "currency"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameterValue",
                                        "value": "{{dlv - ecommerce.currency}}"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameter",
                                        "value": "value"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameterValue",
                                        "value": "{{dlv - ecommerce.value}}"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameter",
                                        "value": "transaction_id"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameterValue",
                                        "value": "{{dlv - ecommerce.transaction_id}}"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameter",
                                        "value": "coupon"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameterValue",
                                        "value": "{{dlv - ecommerce.coupon}}"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameter",
                                        "value": "shipping"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameterValue",
                                        "value": "{{dlv - ecommerce.shipping}}"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameter",
                                        "value": "tax"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameterValue",
                                        "value": "{{dlv - ecommerce.tax}}"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameter",
                                        "value": "items"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameterValue",
                                        "value": "{{dlv - ecommerce.items}}"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameter",
                                        "value": "user_data"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameterValue",
                                        "value": "{{ga4 - user_provided_data}}"
                                    }
                                ]
                            }
                        ]
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "eventName",
                        "value": "new_customer_purchase"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "measurementIdOverride",
                        "value": "{{const - ga4 measurement id}}"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "eventSettingsVariable",
                        "value": "{{ga4 - shared_event_settings}}"
                    }
                ],
                "fingerprint": "1737718470805",
                "firingTriggerId": [
                    "248"
                ],
                "parentFolderId": "100",
                "tagFiringOption": "ONCE_PER_EVENT",
                "monitoringMetadata": {
                    "type": "MAP"
                },
                "consentSettings": {
                    "consentStatus": "NOT_NEEDED"
                }
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "tagId": "273",
                "name": "[KBX] GA4 - purchase",
                "type": "gaawe",
                "parameter": [
                    {
                        "type": "TEMPLATE",
                        "key": "userDataVariable",
                        "value": "{{ga4 - user_provided_data}}"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "sendEcommerceData",
                        "value": "false"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "enhancedUserId",
                        "value": "true"
                    },
                    {
                        "type": "LIST",
                        "key": "eventSettingsTable",
                        "list": [
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameter",
                                        "value": "currency"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameterValue",
                                        "value": "{{dlv - ecommerce.currency}}"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameter",
                                        "value": "value"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameterValue",
                                        "value": "{{dlv - ecommerce.value}}"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameter",
                                        "value": "transaction_id"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameterValue",
                                        "value": "{{dlv - ecommerce.transaction_id}}"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameter",
                                        "value": "coupon"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameterValue",
                                        "value": "{{dlv - ecommerce.coupon}}"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameter",
                                        "value": "shipping"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameterValue",
                                        "value": "{{dlv - ecommerce.shipping}}"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameter",
                                        "value": "tax"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameterValue",
                                        "value": "{{dlv - ecommerce.tax}}"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameter",
                                        "value": "items"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameterValue",
                                        "value": "{{dlv - ecommerce.items}}"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameter",
                                        "value": "user_data"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameterValue",
                                        "value": "{{ga4 - user_provided_data}}"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameter",
                                        "value": "customer_type"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameterValue",
                                        "value": "{{dlv - user_data.new_customer}}"
                                    }
                                ]
                            }
                        ]
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "eventName",
                        "value": "purchase"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "measurementIdOverride",
                        "value": "{{const - ga4 measurement id}}"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "eventSettingsVariable",
                        "value": "{{ga4 - shared_event_settings}}"
                    }
                ],
                "fingerprint": "1737718812244",
                "firingTriggerId": [
                    "111"
                ],
                "parentFolderId": "100",
                "tagFiringOption": "ONCE_PER_EVENT",
                "monitoringMetadata": {
                    "type": "MAP"
                },
                "consentSettings": {
                    "consentStatus": "NOT_SET"
                }
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "tagId": "286",
                "name": "[KBX] DT - purchase",
                "type": "cvt_193445853_254",
                "parameter": [
                    {
                        "type": "BOOLEAN",
                        "key": "add_data_layer",
                        "value": "true"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "request_type",
                        "value": "auto"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "add_consent_state",
                        "value": "true"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "dataLayerEventPush",
                        "value": "false"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "richsstsse",
                        "value": "false"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "data_tag_load_script_url",
                        "value": "https://stapecdn.com/dtag/v8.js"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "add_common_cookie",
                        "value": "true"
                    },
                    {
                        "type": "LIST",
                        "key": "user_data",
                        "list": [
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "email_address"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - user_data.email}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "all"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "city"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - user_data.city}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "all"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "country"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - user_data.country}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "all"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "first_name"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - user_data.first_name}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "all"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "last_name"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - user_data.last_name}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "all"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "region"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - user_data.region}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "all"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "postal_code"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - user_data.zip}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "all"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "user_id"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - user_data.customer_id}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "all"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "phone_number"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - user_data.phone}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "all"
                                    }
                                ]
                            }
                        ]
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "protocol_version",
                        "value": "2"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "event_type",
                        "value": "standard"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "event_name_standard",
                        "value": "purchase"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "gtm_server_domain",
                        "value": "{{const - server_container_url}}"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "request_path",
                        "value": "/data"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "add_common",
                        "value": "true"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "useFetchInsteadOfXHR",
                        "value": "false"
                    },
                    {
                        "type": "LIST",
                        "key": "custom_data",
                        "list": [
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "content_ids"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{ucv - content_ids}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "none"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "contents"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{ucv - contents}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "none"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "currency"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - ecommerce.currency}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "none"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "value"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - ecommerce.value}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "none"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "transaction_id"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - ecommerce.transaction_id}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "none"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "event_id"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{Unique Event ID}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "none"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "customer_type"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - user_data.new_customer}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "localStorage"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "shopify_customer_id"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - user_data.customer_id}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "localStorage"
                                    }
                                ]
                            }
                        ]
                    }
                ],
                "fingerprint": "1737718548244",
                "firingTriggerId": [
                    "111"
                ],
                "parentFolderId": "257",
                "tagFiringOption": "ONCE_PER_EVENT",
                "monitoringMetadata": {
                    "type": "MAP"
                },
                "consentSettings": {
                    "consentStatus": "NOT_SET"
                }
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "tagId": "287",
                "name": "[KBX] DT - new_customer_purchase",
                "type": "cvt_193445853_254",
                "parameter": [
                    {
                        "type": "BOOLEAN",
                        "key": "add_data_layer",
                        "value": "true"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "event_name_custom",
                        "value": "new_customer_purchase"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "request_type",
                        "value": "auto"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "add_consent_state",
                        "value": "true"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "dataLayerEventPush",
                        "value": "false"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "richsstsse",
                        "value": "false"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "data_tag_load_script_url",
                        "value": "https://stapecdn.com/dtag/v8.js"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "add_common_cookie",
                        "value": "true"
                    },
                    {
                        "type": "LIST",
                        "key": "user_data",
                        "list": [
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "email_address"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - user_data.email}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "all"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "city"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - user_data.city}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "all"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "country"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - user_data.country}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "all"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "first_name"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - user_data.first_name}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "all"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "last_name"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - user_data.last_name}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "all"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "region"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - user_data.region}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "all"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "postal_code"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - user_data.zip}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "all"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "user_id"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - user_data.customer_id}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "all"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "phone_number"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - user_data.phone}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "all"
                                    }
                                ]
                            }
                        ]
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "protocol_version",
                        "value": "2"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "event_type",
                        "value": "custom"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "gtm_server_domain",
                        "value": "{{const - server_container_url}}"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "request_path",
                        "value": "/data"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "add_common",
                        "value": "true"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "useFetchInsteadOfXHR",
                        "value": "false"
                    },
                    {
                        "type": "LIST",
                        "key": "custom_data",
                        "list": [
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "content_ids"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{ucv - content_ids}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "none"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "contents"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{ucv - contents}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "none"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "currency"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - ecommerce.currency}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "none"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "value"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - ecommerce.value}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "none"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "transaction_id"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - ecommerce.transaction_id}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "none"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "event_id"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{Unique Event ID}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "none"
                                    }
                                ]
                            }
                        ]
                    }
                ],
                "fingerprint": "1737718470808",
                "firingTriggerId": [
                    "248"
                ],
                "parentFolderId": "257",
                "tagFiringOption": "ONCE_PER_EVENT",
                "monitoringMetadata": {
                    "type": "MAP"
                },
                "consentSettings": {
                    "consentStatus": "NOT_NEEDED"
                }
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "tagId": "289",
                "name": "[KBX] DT - returning_customer_purchase",
                "type": "cvt_193445853_254",
                "parameter": [
                    {
                        "type": "BOOLEAN",
                        "key": "add_data_layer",
                        "value": "true"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "event_name_custom",
                        "value": "returning_customer_purchase"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "request_type",
                        "value": "auto"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "add_consent_state",
                        "value": "true"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "dataLayerEventPush",
                        "value": "false"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "richsstsse",
                        "value": "false"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "data_tag_load_script_url",
                        "value": "https://stapecdn.com/dtag/v8.js"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "add_common_cookie",
                        "value": "true"
                    },
                    {
                        "type": "LIST",
                        "key": "user_data",
                        "list": [
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "email_address"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - user_data.email}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "all"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "city"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - user_data.city}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "all"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "country"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - user_data.country}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "all"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "first_name"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - user_data.first_name}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "all"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "last_name"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - user_data.last_name}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "all"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "region"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - user_data.region}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "all"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "postal_code"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - user_data.zip}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "all"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "user_id"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - user_data.customer_id}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "all"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "phone_number"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - user_data.phone}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "all"
                                    }
                                ]
                            }
                        ]
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "protocol_version",
                        "value": "2"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "event_type",
                        "value": "custom"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "gtm_server_domain",
                        "value": "{{const - server_container_url}}"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "request_path",
                        "value": "/data"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "add_common",
                        "value": "true"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "useFetchInsteadOfXHR",
                        "value": "false"
                    },
                    {
                        "type": "LIST",
                        "key": "custom_data",
                        "list": [
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "content_ids"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{ucv - content_ids}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "none"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "contents"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{ucv - contents}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "none"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "currency"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - ecommerce.currency}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "none"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "value"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - ecommerce.value}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "none"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "transaction_id"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{dlv - ecommerce.transaction_id}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "none"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "name",
                                        "value": "event_id"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "value",
                                        "value": "{{Unique Event ID}}"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "transformation",
                                        "value": "none"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "store",
                                        "value": "none"
                                    }
                                ]
                            }
                        ]
                    }
                ],
                "fingerprint": "1737718470808",
                "firingTriggerId": [
                    "263"
                ],
                "parentFolderId": "257",
                "tagFiringOption": "ONCE_PER_EVENT",
                "monitoringMetadata": {
                    "type": "MAP"
                },
                "consentSettings": {
                    "consentStatus": "NOT_NEEDED"
                }
            }
        ],
        "trigger": [
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "triggerId": "111",
                "name": "ce - purchase_stape",
                "type": "CUSTOM_EVENT",
                "customEventFilter": [
                    {
                        "type": "EQUALS",
                        "parameter": [
                            {
                                "type": "TEMPLATE",
                                "key": "arg0",
                                "value": "{{_event}}"
                            },
                            {
                                "type": "TEMPLATE",
                                "key": "arg1",
                                "value": "purchase_stape"
                            }
                        ]
                    }
                ],
                "fingerprint": "1730901727580",
                "parentFolderId": "90"
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "triggerId": "248",
                "name": "ce - purchase_stape_new",
                "type": "CUSTOM_EVENT",
                "customEventFilter": [
                    {
                        "type": "EQUALS",
                        "parameter": [
                            {
                                "type": "TEMPLATE",
                                "key": "arg0",
                                "value": "{{_event}}"
                            },
                            {
                                "type": "TEMPLATE",
                                "key": "arg1",
                                "value": "purchase_stape"
                            }
                        ]
                    }
                ],
                "filter": [
                    {
                        "type": "EQUALS",
                        "parameter": [
                            {
                                "type": "TEMPLATE",
                                "key": "arg0",
                                "value": "{{dlv - user_data.new_customer}}"
                            },
                            {
                                "type": "TEMPLATE",
                                "key": "arg1",
                                "value": "true"
                            }
                        ]
                    }
                ],
                "fingerprint": "1737718470786",
                "parentFolderId": "90"
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "triggerId": "263",
                "name": "ce - purchase_stape_returning",
                "type": "CUSTOM_EVENT",
                "customEventFilter": [
                    {
                        "type": "EQUALS",
                        "parameter": [
                            {
                                "type": "TEMPLATE",
                                "key": "arg0",
                                "value": "{{_event}}"
                            },
                            {
                                "type": "TEMPLATE",
                                "key": "arg1",
                                "value": "purchase_stape"
                            }
                        ]
                    }
                ],
                "filter": [
                    {
                        "type": "EQUALS",
                        "parameter": [
                            {
                                "type": "TEMPLATE",
                                "key": "arg0",
                                "value": "{{dlv - user_data.new_customer}}"
                            },
                            {
                                "type": "TEMPLATE",
                                "key": "arg1",
                                "value": "false"
                            }
                        ]
                    }
                ],
                "fingerprint": "1737718470805",
                "parentFolderId": "90"
            }
        ],
        "variable": [
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "variableId": "88",
                "name": "dlv - user_data.email",
                "type": "v",
                "parameter": [
                    {
                        "type": "INTEGER",
                        "key": "dataLayerVersion",
                        "value": "2"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "setDefaultValue",
                        "value": "false"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "name",
                        "value": "user_data.email"
                    }
                ],
                "fingerprint": "1730901727578",
                "parentFolderId": "84",
                "formatValue": {}
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "variableId": "89",
                "name": "dlv - user_data.phone",
                "type": "v",
                "parameter": [
                    {
                        "type": "INTEGER",
                        "key": "dataLayerVersion",
                        "value": "2"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "setDefaultValue",
                        "value": "false"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "name",
                        "value": "user_data.phone"
                    }
                ],
                "fingerprint": "1730901727578",
                "parentFolderId": "84",
                "formatValue": {}
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "variableId": "93",
                "name": "dlv - user_data.last_name",
                "type": "v",
                "parameter": [
                    {
                        "type": "INTEGER",
                        "key": "dataLayerVersion",
                        "value": "2"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "setDefaultValue",
                        "value": "false"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "name",
                        "value": "user_data.last_name"
                    }
                ],
                "fingerprint": "1730901727578",
                "parentFolderId": "84",
                "formatValue": {}
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "variableId": "94",
                "name": "dlv - ecommerce.value",
                "type": "v",
                "parameter": [
                    {
                        "type": "INTEGER",
                        "key": "dataLayerVersion",
                        "value": "2"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "setDefaultValue",
                        "value": "false"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "name",
                        "value": "ecommerce.value"
                    }
                ],
                "fingerprint": "1730901727578",
                "parentFolderId": "84",
                "formatValue": {}
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "variableId": "95",
                "name": "dlv - ecommerce.items",
                "type": "v",
                "parameter": [
                    {
                        "type": "INTEGER",
                        "key": "dataLayerVersion",
                        "value": "2"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "setDefaultValue",
                        "value": "false"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "name",
                        "value": "ecommerce.items"
                    }
                ],
                "fingerprint": "1730901727578",
                "parentFolderId": "84",
                "formatValue": {}
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "variableId": "99",
                "name": "dlv - ecomm_pagetype",
                "type": "v",
                "parameter": [
                    {
                        "type": "INTEGER",
                        "key": "dataLayerVersion",
                        "value": "2"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "setDefaultValue",
                        "value": "false"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "name",
                        "value": "ecomm_pagetype"
                    }
                ],
                "fingerprint": "1730901727580",
                "parentFolderId": "84",
                "formatValue": {}
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "variableId": "101",
                "name": "ga4 - shared_event_settings",
                "type": "gtes",
                "parameter": [
                    {
                        "type": "LIST",
                        "key": "eventSettingsTable",
                        "list": [
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameter",
                                        "value": "server_container_url"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameterValue",
                                        "value": "{{const - server_container_url}}"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameter",
                                        "value": "ecomm_prodid"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameterValue",
                                        "value": "{{ucv - ecomm_prodid}}"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameter",
                                        "value": "ecomm_totalvalue"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameterValue",
                                        "value": "{{dlv - ecommerce.value}}"
                                    }
                                ]
                            },
                            {
                                "type": "MAP",
                                "map": [
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameter",
                                        "value": "ecomm_pagetype"
                                    },
                                    {
                                        "type": "TEMPLATE",
                                        "key": "parameterValue",
                                        "value": "{{dlv - ecomm_pagetype}}"
                                    }
                                ]
                            }
                        ]
                    }
                ],
                "fingerprint": "1730901727580",
                "parentFolderId": "100"
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "variableId": "102",
                "name": "dlv - user_data.region",
                "type": "v",
                "parameter": [
                    {
                        "type": "INTEGER",
                        "key": "dataLayerVersion",
                        "value": "2"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "setDefaultValue",
                        "value": "false"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "name",
                        "value": "user_data.region"
                    }
                ],
                "fingerprint": "1730901727580",
                "parentFolderId": "84",
                "formatValue": {}
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "variableId": "103",
                "name": "dlv - ecommerce.tax",
                "type": "v",
                "parameter": [
                    {
                        "type": "INTEGER",
                        "key": "dataLayerVersion",
                        "value": "2"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "setDefaultValue",
                        "value": "false"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "name",
                        "value": "ecommerce.tax"
                    }
                ],
                "fingerprint": "1730901727580",
                "parentFolderId": "84",
                "formatValue": {}
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "variableId": "104",
                "name": "dlv - ecommerce.currency",
                "type": "v",
                "parameter": [
                    {
                        "type": "INTEGER",
                        "key": "dataLayerVersion",
                        "value": "2"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "setDefaultValue",
                        "value": "false"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "name",
                        "value": "ecommerce.currency"
                    }
                ],
                "fingerprint": "1730901727580",
                "parentFolderId": "84",
                "formatValue": {}
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "variableId": "109",
                "name": "dlv - ecommerce.coupon",
                "type": "v",
                "parameter": [
                    {
                        "type": "INTEGER",
                        "key": "dataLayerVersion",
                        "value": "2"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "setDefaultValue",
                        "value": "false"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "name",
                        "value": "ecommerce.coupon"
                    }
                ],
                "fingerprint": "1730901727580",
                "parentFolderId": "84",
                "formatValue": {}
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "variableId": "110",
                "name": "dlv - ecommerce.shipping",
                "type": "v",
                "parameter": [
                    {
                        "type": "INTEGER",
                        "key": "dataLayerVersion",
                        "value": "2"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "setDefaultValue",
                        "value": "false"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "name",
                        "value": "ecommerce.shipping"
                    }
                ],
                "fingerprint": "1730901727580",
                "parentFolderId": "84",
                "formatValue": {}
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "variableId": "112",
                "name": "dlv - ecommerce.transaction_id",
                "type": "v",
                "parameter": [
                    {
                        "type": "INTEGER",
                        "key": "dataLayerVersion",
                        "value": "2"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "setDefaultValue",
                        "value": "false"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "name",
                        "value": "ecommerce.transaction_id"
                    }
                ],
                "fingerprint": "1730901727581",
                "parentFolderId": "84",
                "formatValue": {}
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "variableId": "113",
                "name": "dlv - user_data.zip",
                "type": "v",
                "parameter": [
                    {
                        "type": "INTEGER",
                        "key": "dataLayerVersion",
                        "value": "2"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "setDefaultValue",
                        "value": "false"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "name",
                        "value": "user_data.zip"
                    }
                ],
                "fingerprint": "1730901727581",
                "parentFolderId": "84",
                "formatValue": {}
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "variableId": "114",
                "name": "dlv - user_data.first_name",
                "type": "v",
                "parameter": [
                    {
                        "type": "INTEGER",
                        "key": "dataLayerVersion",
                        "value": "2"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "setDefaultValue",
                        "value": "false"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "name",
                        "value": "user_data.first_name"
                    }
                ],
                "fingerprint": "1730901727581",
                "parentFolderId": "84",
                "formatValue": {}
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "variableId": "115",
                "name": "dlv - user_data.street",
                "type": "v",
                "parameter": [
                    {
                        "type": "INTEGER",
                        "key": "dataLayerVersion",
                        "value": "2"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "setDefaultValue",
                        "value": "false"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "name",
                        "value": "user_data.street"
                    }
                ],
                "fingerprint": "1730901727581",
                "parentFolderId": "84",
                "formatValue": {}
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "variableId": "116",
                "name": "dlv - user_data.city",
                "type": "v",
                "parameter": [
                    {
                        "type": "INTEGER",
                        "key": "dataLayerVersion",
                        "value": "2"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "setDefaultValue",
                        "value": "false"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "name",
                        "value": "user_data.city"
                    }
                ],
                "fingerprint": "1730901727581",
                "parentFolderId": "84",
                "formatValue": {}
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "variableId": "117",
                "name": "dlv - user_data.country",
                "type": "v",
                "parameter": [
                    {
                        "type": "INTEGER",
                        "key": "dataLayerVersion",
                        "value": "2"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "setDefaultValue",
                        "value": "false"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "name",
                        "value": "user_data.country"
                    }
                ],
                "fingerprint": "1730901727581",
                "parentFolderId": "84",
                "formatValue": {}
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "variableId": "118",
                "name": "ga4 - user_provided_data",
                "type": "awec",
                "parameter": [
                    {
                        "type": "TEMPLATE",
                        "key": "mode",
                        "value": "MANUAL"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "country",
                        "value": "{{dlv - user_data.country}}"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "city",
                        "value": "{{dlv - user_data.city}}"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "street",
                        "value": "{{dlv - user_data.street}}"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "last_name",
                        "value": "{{dlv - user_data.last_name}}"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "phone_number",
                        "value": "{{dlv - user_data.phone}}"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "region",
                        "value": "{{dlv - user_data.region}}"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "postal_code",
                        "value": "{{dlv - user_data.zip}}"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "first_name",
                        "value": "{{dlv - user_data.first_name}}"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "email",
                        "value": "{{dlv - user_data.email}}"
                    }
                ],
                "fingerprint": "1730901727581",
                "parentFolderId": "100",
                "formatValue": {}
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "variableId": "130",
                "name": "dlv - user_data.customer_id",
                "type": "v",
                "parameter": [
                    {
                        "type": "INTEGER",
                        "key": "dataLayerVersion",
                        "value": "2"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "setDefaultValue",
                        "value": "false"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "name",
                        "value": "user_data.customer_id"
                    }
                ],
                "fingerprint": "1730901727582",
                "parentFolderId": "84",
                "formatValue": {}
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "variableId": "239",
                "name": "const - server_container_url",
                "type": "c",
                "parameter": [
                    {
                        "type": "TEMPLATE",
                        "key": "value",
                        "value": "VALUE_HERE"
                    }
                ],
                "fingerprint": "1737718770774",
                "parentFolderId": "86",
                "formatValue": {}
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "variableId": "240",
                "name": "const - ga4 measurement id",
                "type": "c",
                "notes": "Used to store the GA4 measurement ID",
                "parameter": [
                    {
                        "type": "TEMPLATE",
                        "key": "value",
                        "value": "VALUE_HERE"
                    }
                ],
                "fingerprint": "1737718779670",
                "parentFolderId": "86",
                "formatValue": {}
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "variableId": "244",
                "name": "ucv - ecomm_prodid",
                "type": "cvt_193445853_243",
                "parameter": [
                    {
                        "type": "TEMPLATE",
                        "key": "keyQt",
                        "value": "quantity"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "keyPr",
                        "value": "price"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "ga4_task",
                        "value": "ids"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "keyId",
                        "value": "item_id"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "orderItems",
                        "value": "{{dlv - ecommerce.items}}"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "keyNm",
                        "value": "item_name"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "platform",
                        "value": "ga4"
                    }
                ],
                "fingerprint": "1737718470786",
                "parentFolderId": "97",
                "formatValue": {}
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "variableId": "247",
                "name": "dlv - user_data.new_customer",
                "type": "v",
                "parameter": [
                    {
                        "type": "INTEGER",
                        "key": "dataLayerVersion",
                        "value": "2"
                    },
                    {
                        "type": "BOOLEAN",
                        "key": "setDefaultValue",
                        "value": "false"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "name",
                        "value": "user_data.new_customer"
                    }
                ],
                "fingerprint": "1737718470786",
                "parentFolderId": "84",
                "formatValue": {}
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "variableId": "256",
                "name": "Unique Event ID",
                "type": "cvt_193445853_255",
                "fingerprint": "1737718470803",
                "parentFolderId": "97",
                "formatValue": {}
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "variableId": "258",
                "name": "ucv - content_ids",
                "type": "cvt_193445853_243",
                "parameter": [
                    {
                        "type": "TEMPLATE",
                        "key": "keyQt",
                        "value": "quantity"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "keyPr",
                        "value": "price"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "keyId",
                        "value": "item_id"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "meta_task",
                        "value": "ids"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "orderItems",
                        "value": "{{dlv - ecommerce.items}}"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "keyNm",
                        "value": "item_name"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "platform",
                        "value": "meta"
                    }
                ],
                "fingerprint": "1737718470804",
                "parentFolderId": "97",
                "formatValue": {}
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "variableId": "260",
                "name": "ucv - contents",
                "type": "cvt_193445853_243",
                "parameter": [
                    {
                        "type": "TEMPLATE",
                        "key": "keyQt",
                        "value": "quantity"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "keyPr",
                        "value": "price"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "keyId",
                        "value": "item_id"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "meta_task",
                        "value": "contents"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "orderItems",
                        "value": "{{dlv - ecommerce.items}}"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "keyNm",
                        "value": "item_name"
                    },
                    {
                        "type": "TEMPLATE",
                        "key": "platform",
                        "value": "meta"
                    }
                ],
                "fingerprint": "1737718470804",
                "parentFolderId": "97",
                "formatValue": {}
            }
        ],
        "folder": [
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "folderId": "84",
                "name": "[Stape] Data Layer",
                "fingerprint": "1730901727577"
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "folderId": "86",
                "name": "[Stape] _Settings",
                "fingerprint": "1730901727578"
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "folderId": "90",
                "name": "[Stape] Triggers",
                "fingerprint": "1730901727578"
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "folderId": "97",
                "name": "[Stape] Data Other",
                "fingerprint": "1730901727579"
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "folderId": "100",
                "name": "[Stape] GA4",
                "fingerprint": "1730901727580"
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "folderId": "257",
                "name": "[Stape] Data Tags",
                "fingerprint": "1737718470803"
            }
        ],
        "fingerprint": "1737719193329",
        "tagManagerUrl": "https://tagmanager.google.com/#/versions/accounts/6246124678/containers/193445853/versions/0?apiLink=version",
        "customTemplate": [
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "templateId": "243",
                "name": "Universal Conversions Variable",
                "fingerprint": "1737718470778",
                "templateData": "___TERMS_OF_SERVICE___\n\nBy creating or modifying this file you agree to Google Tag Manager's Community\nTemplate Gallery Developer Terms of Service available at\nhttps://developers.google.com/tag-manager/gallery-tos (or such other URL as\nGoogle may provide), as modified from time to time.\n\n\n___INFO___\n\n{\n  \"type\": \"MACRO\",\n  \"id\": \"cvt_temp_public_id\",\n  \"version\": 1,\n  \"securityGroups\": [],\n  \"displayName\": \"Universal Conversions Variable\",\n  \"description\": \"Generates the desired parameter from an array.\\nby Stape.io\",\n  \"containerContexts\": [\n    \"WEB\"\n  ],\n  \"brand\": {\n    \"displayName\": \"stape-io\",\n    \"id\": \"github.com_stape-io\"\n  }\n}\n\n\n___TEMPLATE_PARAMETERS___\n\n[\n  {\n    \"type\": \"SELECT\",\n    \"name\": \"platform\",\n    \"displayName\": \"Platform\",\n    \"macrosInSelect\": false,\n    \"selectItems\": [\n      {\n        \"value\": \"meta\",\n        \"displayValue\": \"Meta Pixel/CAPI\"\n      },\n      {\n        \"value\": \"ga4\",\n        \"displayValue\": \"Google Analytics 4\"\n      },\n      {\n        \"value\": \"tiktok\",\n        \"displayValue\": \"TikTok CAPI\"\n      },\n      {\n        \"value\": \"twitter\",\n        \"displayValue\": \"Twitter CAPI\"\n      },\n      {\n        \"value\": \"microsoft\",\n        \"displayValue\": \"Microsoft Ads\"\n      },\n      {\n        \"value\": \"klaviyo\",\n        \"displayValue\": \"Klaviyo\"\n      },\n      {\n        \"value\": \"snap\",\n        \"displayValue\": \"Snapchat\"\n      },\n      {\n        \"value\": \"gAdsOff\",\n        \"displayValue\": \"Google Ads Offline\"\n      },\n      {\n        \"value\": \"pinterest\",\n        \"displayValue\": \"Pinterest\"\n      },\n      {\n        \"value\": \"rakuten\",\n        \"displayValue\": \"Rakuten\"\n      },\n      {\n        \"value\": \"criteo\",\n        \"displayValue\": \"Criteo\"\n      }\n    ],\n    \"simpleValueType\": true,\n    \"help\": \"Choose which platform to generate parameter\"\n  },\n  {\n    \"type\": \"RADIO\",\n    \"name\": \"meta_task\",\n    \"displayName\": \"What to return\",\n    \"radioItems\": [\n      {\n        \"value\": \"contents\",\n        \"displayValue\": \"contents [ {} ]\"\n      },\n      {\n        \"value\": \"ids\",\n        \"displayValue\": \"content_ids [ ]\"\n      },\n      {\n        \"value\": \"name\",\n        \"displayValue\": \"content_name \\u0027 \\u0027\",\n        \"help\": \"will only return value if there is one object in product array, since content_name parameter is applicable only to single product (type) events\"\n      },\n      {\n        \"value\": \"value\",\n        \"displayValue\": \"value\",\n        \"help\": \"use wisely, value will be calculated based on product prices and will not account for discounts. not recommended for purchase events\"\n      },\n      {\n        \"value\": \"numitems\",\n        \"displayValue\": \"num_items\",\n        \"subParams\": []\n      }\n    ],\n    \"simpleValueType\": true,\n    \"enablingConditions\": [\n      {\n        \"paramName\": \"platform\",\n        \"paramValue\": \"meta\",\n        \"type\": \"EQUALS\"\n      }\n    ]\n  },\n  {\n    \"type\": \"RADIO\",\n    \"name\": \"ga4_task\",\n    \"displayName\": \"What to return\",\n    \"radioItems\": [\n      {\n        \"value\": \"value\",\n        \"displayValue\": \"value\",\n        \"help\": \"use wisely, value will be calculated based on product prices and will not account for discounts. not recommended for purchase events\"\n      },\n      {\n        \"value\": \"items\",\n        \"displayValue\": \"items\",\n        \"help\": \"\"\n      },\n      {\n        \"value\": \"ids\",\n        \"displayValue\": \"ecomm_prodid\",\n        \"help\": \"for Ads Remarketing\"\n      }\n    ],\n    \"simpleValueType\": true,\n    \"enablingConditions\": [\n      {\n        \"paramName\": \"platform\",\n        \"paramValue\": \"ga4\",\n        \"type\": \"EQUALS\"\n      }\n    ]\n  },\n  {\n    \"type\": \"RADIO\",\n    \"name\": \"rakuten_task\",\n    \"displayName\": \"What to return\",\n    \"radioItems\": [\n      {\n        \"value\": \"items\",\n        \"displayValue\": \"line_items\",\n        \"help\": \"\",\n        \"subParams\": []\n      }\n    ],\n    \"simpleValueType\": true,\n    \"enablingConditions\": [\n      {\n        \"paramName\": \"platform\",\n        \"paramValue\": \"rakuten\",\n        \"type\": \"EQUALS\"\n      }\n    ]\n  },\n  {\n    \"type\": \"RADIO\",\n    \"name\": \"gAdsOff_task\",\n    \"displayName\": \"What to return\",\n    \"radioItems\": [\n      {\n        \"value\": \"value\",\n        \"displayValue\": \"value\",\n        \"help\": \"use wisely, value will be calculated based on product prices and will not account for discounts. not recommended for purchase events\"\n      },\n      {\n        \"value\": \"items\",\n        \"displayValue\": \"items\"\n      }\n    ],\n    \"simpleValueType\": true,\n    \"enablingConditions\": [\n      {\n        \"paramName\": \"platform\",\n        \"paramValue\": \"gAdsOff\",\n        \"type\": \"EQUALS\"\n      }\n    ]\n  },\n  {\n    \"type\": \"RADIO\",\n    \"name\": \"klaviyo_task\",\n    \"displayName\": \"What to return\",\n    \"radioItems\": [\n      {\n        \"value\": \"value\",\n        \"displayValue\": \"value\",\n        \"help\": \"use wisely, value will be calculated based on product prices and will not account for discounts. not recommended for purchase events\"\n      },\n      {\n        \"value\": \"item\",\n        \"displayValue\": \"item\",\n        \"help\": \"for ViewedProduct event\"\n      },\n      {\n        \"value\": \"items\",\n        \"displayValue\": \"items\"\n      }\n    ],\n    \"simpleValueType\": true,\n    \"enablingConditions\": [\n      {\n        \"paramName\": \"platform\",\n        \"paramValue\": \"klaviyo\",\n        \"type\": \"EQUALS\"\n      }\n    ]\n  },\n  {\n    \"type\": \"RADIO\",\n    \"name\": \"microsoft_task\",\n    \"displayName\": \"What to return\",\n    \"radioItems\": [\n      {\n        \"value\": \"value\",\n        \"displayValue\": \"revenue_value\",\n        \"help\": \"use wisely, value will be calculated based on product prices and will not account for discounts. not recommended for purchase events\"\n      }\n    ],\n    \"simpleValueType\": true,\n    \"enablingConditions\": [\n      {\n        \"paramName\": \"platform\",\n        \"paramValue\": \"microsoft\",\n        \"type\": \"EQUALS\"\n      }\n    ]\n  },\n  {\n    \"type\": \"RADIO\",\n    \"name\": \"tiktok_task\",\n    \"displayName\": \"What to return\",\n    \"radioItems\": [\n      {\n        \"value\": \"contents\",\n        \"displayValue\": \"contents [ {} ]\",\n        \"subParams\": [\n          {\n            \"type\": \"SELECT\",\n            \"name\": \"contentType\",\n            \"displayName\": \"content_type parameter\",\n            \"macrosInSelect\": false,\n            \"selectItems\": [\n              {\n                \"value\": \"product\",\n                \"displayValue\": \"product\"\n              },\n              {\n                \"value\": \"product_group\",\n                \"displayValue\": \"product_group\"\n              }\n            ],\n            \"simpleValueType\": true,\n            \"help\": \"choose either product or product_group as is required by TikTok events API\",\n            \"defaultValue\": \"product\",\n            \"enablingConditions\": []\n          }\n        ]\n      },\n      {\n        \"value\": \"name\",\n        \"displayValue\": \"content_name \\u0027 \\u0027\",\n        \"help\": \"will only return value if there is one object in product array, since content_name parameter is applicable only to single product (type) events\"\n      },\n      {\n        \"value\": \"value\",\n        \"displayValue\": \"value\",\n        \"help\": \"use wisely, value will be calculated based on product prices and will not account for discounts. not recommended for purchase events\"\n      },\n      {\n        \"value\": \"numitems\",\n        \"displayValue\": \"num_items\",\n        \"subParams\": []\n      }\n    ],\n    \"simpleValueType\": true,\n    \"enablingConditions\": [\n      {\n        \"paramName\": \"platform\",\n        \"paramValue\": \"tiktok\",\n        \"type\": \"EQUALS\"\n      }\n    ]\n  },\n  {\n    \"type\": \"RADIO\",\n    \"name\": \"twitter_task\",\n    \"displayName\": \"What to return\",\n    \"radioItems\": [\n      {\n        \"value\": \"contents\",\n        \"displayValue\": \"contents [{ }]\"\n      },\n      {\n        \"value\": \"value\",\n        \"displayValue\": \"value\",\n        \"subParams\": [],\n        \"help\": \"use wisely, value will be calculated based on product prices and will not account for discounts. not recommended for purchase events\"\n      }\n    ],\n    \"simpleValueType\": true,\n    \"enablingConditions\": [\n      {\n        \"paramName\": \"platform\",\n        \"paramValue\": \"twitter\",\n        \"type\": \"EQUALS\"\n      }\n    ]\n  },\n  {\n    \"type\": \"RADIO\",\n    \"name\": \"criteo_task\",\n    \"displayName\": \"What to return\",\n    \"radioItems\": [\n      {\n        \"value\": \"items\",\n        \"displayValue\": \"items [{ }]\"\n      }\n    ],\n    \"simpleValueType\": true,\n    \"enablingConditions\": [\n      {\n        \"paramName\": \"platform\",\n        \"paramValue\": \"criteo\",\n        \"type\": \"EQUALS\"\n      }\n    ]\n  },\n  {\n    \"type\": \"RADIO\",\n    \"name\": \"pinterest_task\",\n    \"displayName\": \"What to return\",\n    \"radioItems\": [\n      {\n        \"value\": \"items\",\n        \"displayValue\": \"line_items [{ }]\"\n      },\n      {\n        \"value\": \"value\",\n        \"displayValue\": \"value\",\n        \"subParams\": [],\n        \"help\": \"use wisely, value will be calculated based on product prices and will not account for discounts. not recommended for purchase events\"\n      },\n      {\n        \"value\": \"ids\",\n        \"displayValue\": \"content_ids [ ]\"\n      },\n      {\n        \"value\": \"contents\",\n        \"displayValue\": \"contents [{ }]\"\n      }\n    ],\n    \"simpleValueType\": true,\n    \"enablingConditions\": [\n      {\n        \"paramName\": \"platform\",\n        \"paramValue\": \"pinterest\",\n        \"type\": \"EQUALS\"\n      }\n    ]\n  },\n  {\n    \"type\": \"RADIO\",\n    \"name\": \"snap_task\",\n    \"displayName\": \"What to return\",\n    \"radioItems\": [\n      {\n        \"value\": \"value\",\n        \"displayValue\": \"price\",\n        \"help\": \"use wisely, value will be calculated based on product prices and will not account for discounts. not recommended for purchase events\"\n      },\n      {\n        \"value\": \"ids\",\n        \"displayValue\": \"item_ids\"\n      },\n      {\n        \"value\": \"numitems\",\n        \"displayValue\": \"number_items\",\n        \"subParams\": []\n      }\n    ],\n    \"simpleValueType\": true,\n    \"enablingConditions\": [\n      {\n        \"paramName\": \"platform\",\n        \"paramValue\": \"snap\",\n        \"type\": \"EQUALS\"\n      }\n    ]\n  },\n  {\n    \"type\": \"GROUP\",\n    \"name\": \"arrayGroup\",\n    \"displayName\": \"Input Array\",\n    \"groupStyle\": \"ZIPPY_OPEN\",\n    \"subParams\": [\n      {\n        \"type\": \"TEXT\",\n        \"name\": \"orderItems\",\n        \"displayName\": \"Array of Objects\",\n        \"simpleValueType\": true,\n        \"help\": \"[{}] any structured array of item objects\",\n        \"valueValidators\": [\n          {\n            \"type\": \"NON_EMPTY\"\n          }\n        ]\n      }\n    ]\n  },\n  {\n    \"type\": \"GROUP\",\n    \"name\": \"keyGroup\",\n    \"displayName\": \"Input Array Keys\",\n    \"groupStyle\": \"ZIPPY_OPEN\",\n    \"subParams\": [\n      {\n        \"type\": \"TEXT\",\n        \"name\": \"keyId\",\n        \"displayName\": \"Product ID/SKU\",\n        \"simpleValueType\": true,\n        \"valueValidators\": [\n          {\n            \"type\": \"NON_EMPTY\"\n          }\n        ]\n      },\n      {\n        \"type\": \"TEXT\",\n        \"name\": \"keyNm\",\n        \"displayName\": \"Product Name\",\n        \"simpleValueType\": true,\n        \"valueValidators\": [\n          {\n            \"type\": \"NON_EMPTY\"\n          }\n        ]\n      },\n      {\n        \"type\": \"TEXT\",\n        \"name\": \"keyPr\",\n        \"displayName\": \"Product Price\",\n        \"simpleValueType\": true,\n        \"valueValidators\": [\n          {\n            \"type\": \"NON_EMPTY\"\n          }\n        ]\n      },\n      {\n        \"type\": \"TEXT\",\n        \"name\": \"keyQt\",\n        \"displayName\": \"Product Quantity\",\n        \"simpleValueType\": true,\n        \"valueValidators\": [\n          {\n            \"type\": \"NON_EMPTY\"\n          }\n        ]\n      },\n      {\n        \"type\": \"TEXT\",\n        \"name\": \"keyCat\",\n        \"displayName\": \"Product Category\",\n        \"simpleValueType\": true,\n        \"enablingConditions\": [\n          {\n            \"paramName\": \"platform\",\n            \"paramValue\": \"ga4\",\n            \"type\": \"EQUALS\"\n          },\n          {\n            \"paramName\": \"platform\",\n            \"paramValue\": \"klaviyo\",\n            \"type\": \"EQUALS\"\n          },\n          {\n            \"paramName\": \"platform\",\n            \"paramValue\": \"twitter\",\n            \"type\": \"EQUALS\"\n          }\n        ]\n      },\n      {\n        \"type\": \"TEXT\",\n        \"name\": \"keyImg\",\n        \"displayName\": \"Product Image URL\",\n        \"simpleValueType\": true,\n        \"enablingConditions\": [\n          {\n            \"paramName\": \"platform\",\n            \"paramValue\": \"klaviyo\",\n            \"type\": \"EQUALS\"\n          }\n        ]\n      },\n      {\n        \"type\": \"CHECKBOX\",\n        \"name\": \"buildCatTree\",\n        \"checkboxText\": \"Build Category Tree?\",\n        \"simpleValueType\": true,\n        \"help\": \"If your items have multiple categories, create a tree in \\u0027cat1 \\u003e cat2 \\u003e cat3\\u0027 string format\",\n        \"enablingConditions\": [\n          {\n            \"paramName\": \"platform\",\n            \"paramValue\": \"rakuten\",\n            \"type\": \"EQUALS\"\n          }\n        ]\n      },\n      {\n        \"type\": \"TEXT\",\n        \"name\": \"keyCatList\",\n        \"displayName\": \"Category parameter keys\",\n        \"simpleValueType\": true,\n        \"help\": \"coma separated in order of appearance in tree, like: \\u0027cat_key,mykey,custom_var_7\\u0027\",\n        \"enablingConditions\": [\n          {\n            \"paramName\": \"buildCatTree\",\n            \"paramValue\": true,\n            \"type\": \"EQUALS\"\n          }\n        ]\n      }\n    ],\n    \"help\": \"keys for corresponding parameters within input array\"\n  },\n  {\n    \"type\": \"GROUP\",\n    \"name\": \"rakDiscountGroup\",\n    \"displayName\": \"Discount Configuration\",\n    \"groupStyle\": \"ZIPPY_OPEN\",\n    \"subParams\": [\n      {\n        \"type\": \"SELECT\",\n        \"name\": \"discConfig\",\n        \"displayName\": \"Choose discount configuration method\",\n        \"macrosInSelect\": false,\n        \"selectItems\": [\n          {\n            \"value\": \"item_level\",\n            \"displayValue\": \"From item-level\"\n          },\n          {\n            \"value\": \"order_level\",\n            \"displayValue\": \"From order-level\"\n          },\n          {\n            \"value\": \"none\",\n            \"displayValue\": \"None\"\n          }\n        ],\n        \"simpleValueType\": true,\n        \"defaultValue\": \"none\"\n      },\n      {\n        \"type\": \"TEXT\",\n        \"name\": \"keyDiscItemLevel\",\n        \"displayName\": \"Parameter key for item-level discount\",\n        \"simpleValueType\": true,\n        \"enablingConditions\": [\n          {\n            \"paramName\": \"discConfig\",\n            \"paramValue\": \"item_level\",\n            \"type\": \"EQUALS\"\n          }\n        ],\n        \"help\": \"discount parameter KEY for input array\"\n      },\n      {\n        \"type\": \"TEXT\",\n        \"name\": \"discOrderLevel\",\n        \"displayName\": \"Order-level discount amount\",\n        \"simpleValueType\": true,\n        \"help\": \"order-level discount VALUE\",\n        \"enablingConditions\": [\n          {\n            \"paramName\": \"discConfig\",\n            \"paramValue\": \"order_level\",\n            \"type\": \"EQUALS\"\n          }\n        ]\n      }\n    ],\n    \"enablingConditions\": [\n      {\n        \"paramName\": \"platform\",\n        \"paramValue\": \"rakuten\",\n        \"type\": \"EQUALS\"\n      }\n    ]\n  },\n  {\n    \"type\": \"GROUP\",\n    \"name\": \"rakTaxGroup\",\n    \"displayName\": \"Tax Configuration\",\n    \"groupStyle\": \"ZIPPY_OPEN\",\n    \"subParams\": [\n      {\n        \"type\": \"SELECT\",\n        \"name\": \"taxPriceConfig\",\n        \"displayName\": \"Item price tax application\",\n        \"macrosInSelect\": false,\n        \"selectItems\": [\n          {\n            \"value\": \"priceTaxless\",\n            \"displayValue\": \"Item price is taxless\"\n          },\n          {\n            \"value\": \"priceDeduct\",\n            \"displayValue\": \"Item price needs tax deduction\"\n          }\n        ],\n        \"simpleValueType\": true\n      },\n      {\n        \"type\": \"SELECT\",\n        \"name\": \"taxDiscountConfig\",\n        \"displayName\": \"Discount tax application\",\n        \"macrosInSelect\": false,\n        \"selectItems\": [\n          {\n            \"value\": \"discTaxless\",\n            \"displayValue\": \"Discount is taxless\"\n          },\n          {\n            \"value\": \"discDeduct\",\n            \"displayValue\": \"Discount needs tax deduction\"\n          }\n        ],\n        \"simpleValueType\": true\n      },\n      {\n        \"type\": \"TEXT\",\n        \"name\": \"taxDeductPercent\",\n        \"displayName\": \"Tax %\",\n        \"simpleValueType\": true,\n        \"help\": \"just number, no % symbol\",\n        \"valueValidators\": [],\n        \"enablingConditions\": [\n          {\n            \"paramName\": \"taxPriceConfig\",\n            \"paramValue\": \"priceDeduct\",\n            \"type\": \"EQUALS\"\n          },\n          {\n            \"paramName\": \"taxDiscountConfig\",\n            \"paramValue\": \"discDeduct\",\n            \"type\": \"EQUALS\"\n          }\n        ]\n      }\n    ],\n    \"enablingConditions\": [\n      {\n        \"paramName\": \"platform\",\n        \"paramValue\": \"rakuten\",\n        \"type\": \"EQUALS\"\n      }\n    ]\n  },\n  {\n    \"type\": \"GROUP\",\n    \"name\": \"customParamsGroup\",\n    \"displayName\": \"Additional/Optional Parameters\",\n    \"groupStyle\": \"ZIPPY_OPEN\",\n    \"subParams\": [\n      {\n        \"type\": \"SIMPLE_TABLE\",\n        \"name\": \"customParams\",\n        \"displayName\": \"\",\n        \"simpleTableColumns\": [\n          {\n            \"defaultValue\": \"\",\n            \"displayName\": \"Custom parameter key in your array\",\n            \"name\": \"cusKey\",\n            \"type\": \"TEXT\"\n          },\n          {\n            \"defaultValue\": \"\",\n            \"displayName\": \"Custom parameter name to return\",\n            \"name\": \"cusName\",\n            \"type\": \"TEXT\"\n          }\n        ],\n        \"newRowButtonText\": \"Add Custom Parameter\",\n        \"alwaysInSummary\": false\n      }\n    ],\n    \"enablingConditions\": [\n      {\n        \"paramName\": \"platform\",\n        \"paramValue\": \"ga4\",\n        \"type\": \"EQUALS\"\n      },\n      {\n        \"paramName\": \"platform\",\n        \"paramValue\": \"klaviyo\",\n        \"type\": \"EQUALS\"\n      },\n      {\n        \"paramName\": \"platform\",\n        \"paramValue\": \"rakuten\",\n        \"type\": \"EQUALS\"\n      }\n    ]\n  }\n]\n\n\n___SANDBOXED_JS_FOR_WEB_TEMPLATE___\n\nconst makeInteger = require('makeInteger');\nconst makeNumber = require('makeNumber');\nconst makeString = require('makeString');\nconst makeTableMap = require('makeTableMap');\nconst getType = require('getType');\nconst math = require('Math');\n\nlet keyId = data.keyId;\nlet keyPr = data.keyPr;\nlet keyNm = data.keyNm;\nlet keyQt = data.keyQt;\nlet keyVar = data.keyVar;\nlet keyCat = data.keyCat;\nlet keyImg = data.keyImg;\nlet contentType = data.contentType;\nlet taxDeductPercent = toFixed2(makeNumber(data.taxDeductPercent));\nlet task; \nconst customParamMap = data.customParams ? makeTableMap(data.customParams, 'cusKey', 'cusName') : {};\n\nlet keyDisc = data.keyDiscItemLevel;\n//let rakTax = makeNumber(data.rakTax);\n\nlet keyCatList = data.keyCatList ? data.keyCatList.split(',') : [];\n\nif (!data.orderItems || !data.orderItems.length)\n  return ;\nelse\n  return runTask();\n\n\nfunction runTask() {\n\n  if (data.meta_task)\n    task = data.meta_task;\n\n  if (data.ga4_task)\n    task = data.ga4_task;\n\n  if (data.tiktok_task)\n    task = data.tiktok_task;\n\n  if (data.twitter_task)\n    task = data.twitter_task;\n\n  if (data.microsoft_task)\n    task = data.microsoft_task;\n\n  if (data.klaviyo_task)\n    task = data.klaviyo_task;\n  \n  if (data.snap_task)\n    task = data.snap_task;\n\n  if (data.gAdsOff_task)\n    task = data.gAdsOff_task;\n  \n  if (data.pinterest_task)\n    task = data.pinterest_task;\n  \n  if (data.rakuten_task)\n    task = data.rakuten_task;\n  \n  if (data.criteo_task)\n    task = data.criteo_task;\n\n  if (task === 'contents')\n    return getContents(data.orderItems, data.platform);\n\n  if (task === 'ids')\n    return getContentIds(data.orderItems);\n\n  if (task === 'name')\n    return getContentName(data.orderItems);\n\n  if (task === 'value')\n    return getValue(data.orderItems);\n\n  if (task === 'numitems')\n    return getNumItems(data.orderItems);\n\n  if (task === 'items')\n    return getItems(data.orderItems, data.platform);\n  \n  if (task === 'item')\n    return getItem(data.orderItems);\n}  \n\n\nfunction toFixed2(num){\n   return math.round(num * 100) / 100;\n}\n\n\nfunction makeNumberToFixed2(str) {\n  \n  const dotIndex = str.indexOf('.');\n  \n  if (dotIndex < 0)\n    return makeNumber(str + '.00');\n  \n  let integerPart = str.substring(0, dotIndex);\n  let decimalPart = str.substring(dotIndex + 1, dotIndex + 3);\n  \n  let a = decimalPart[0] ? decimalPart[0] : '0';\n  let b = decimalPart[1] ? decimalPart[1] : '0';\n\n  return makeNumber(integerPart + '.' + a + b);\n}\n\n\nfunction getItem(arr) {\n\n  let cat = [];\n  cat.push(arr[0][keyCat]);\n      \n  let item = {\n    'ProductID': arr[0][keyId],\n    'ProductName': arr[0][keyNm],\n    'Price': arr[0][keyPr],\n    'ImageURL': arr[0][keyImg],\n    'Categories': cat\n  };\n\n  return item;\n}\n\n\n\nfunction getContents(arr, platform) {\n  \n  let contents = [];\n  \n  for (let i = 0; i < arr.length; i++) {\n    \n    let qt = 1;\n    if (arr[i][keyQt])\n      qt = makeNumber(arr[i][keyQt]);\n    \n    if (platform === 'meta') {\n      contents.push({\n        'id': arr[i][keyId],\n        'quantity': qt,\n        'item_price': arr[i][keyPr]\n      });\n    }\n    \n    if (platform === 'tiktok') {\n      contents.push({\n        'content_id': arr[i][keyId],\n        'content_type': contentType,\n        'content_category': arr[i][keyCat],\n        'content_name': arr[i][keyNm],\n        'quantity': qt,\n        'price': arr[i][keyPr] ? makeNumber(arr[i][keyPr]) : 0,\n      });\n    }\n    \n    if (platform === 'twitter') {\n      contents.push({\n        'content_id': arr[i][keyId],\n        'content_name': arr[i][keyNm],\n        'content_type': arr[i][keyCat],\n        'num_items': qt,\n        'content_price': arr[i][keyPr]\n      });\n    }\n    \n    if (platform === 'pinterest') {\n      contents.push({\n        'quantity': qt,\n        'item_price': arr[i][keyPr] ? makeString(arr[i][keyPr]) : '0'\n      });\n    }\n        \n  }\n\n  return contents;\n}\n\n\nfunction getContentIds(arr) {\n  \n  let content_ids = [];\n\n  for (let i = 0; i < arr.length; i++) {\n    content_ids.push(arr[i][keyId]);\n  }\n    \n  return content_ids;\n}\n\n\nfunction getValue(arr) {\n  \n  let value = 0; \n  let price;\n  \n  for (let i = 0; i < arr.length; i++) {\n\n    price = arr[i][keyPr] ? makeNumber(arr[i][keyPr]) : 0;\n    \n    \n    if (arr[i][keyQt]) {\n\n       if (getType(arr[i][keyQt]) === 'string')\n         value = value + makeInteger(arr[i][keyQt]) * price;   \n       else             \n         value = value + arr[i][keyQt] * price;\n     \n     }\n     else\n       value = value + price;\n  }\n    \n  let res = math.round(value * 100) / 100; \n  return res;\n}\n\n\nfunction getItems(arr, platform) {\n\n  let items = [];\n  let totalDiscount = 0;\n  if (data.discConfig === 'order_level') {\n    \n    totalDiscount = makeNumber(data.discOrderLevel);\n    \n    if (data.taxDiscountConfig == 'discDeduct') {\n      totalDiscount = totalDiscount / ((taxDeductPercent / 100) + 1);\n    }\n      \n  }\n  \n  for (let i = 0; i < arr.length; i++) {\n    \n    let qt = 1;\n    if (arr[i][keyQt])\n      qt = makeInteger(arr[i][keyQt]);\n\n    if (platform === 'ga4') {    \n      \n      let itemObj = {\n        'item_id': arr[i][keyId],\n        'item_name': arr[i][keyNm],\n        'quantity': qt,\n        'price': arr[i][keyPr],\n        'item_category': arr[i][keyCat]\n      };\n      \n      for (let prop in customParamMap) {\n        if (customParamMap[prop]) {\n          if (prop === 'discountamountqty')\n            itemObj[customParamMap[prop]] = arr[i][prop] * qt;\n          else\n            itemObj[customParamMap[prop]] = arr[i][prop];\n        }\n      }    \n      \n      items.push(itemObj);      \n      \n    }\n    \n    if (platform === 'klaviyo') {    \n      \n      let cat = [];\n      cat.push(arr[i][keyCat]);\n      \n      let itemObj = {\n        'ProductID': arr[i][keyId],\n        'ProductName': arr[i][keyNm],\n        'Quantity': qt,\n        'ItemPrice': arr[i][keyPr],\n        'ImageURL': arr[i][keyImg],\n        'ProductCategories': cat\n      };\n\n      for (let prop in customParamMap) {\n        if (customParamMap[prop]) { \n          itemObj[customParamMap[prop]] = arr[i][prop];\n        }\n      }\n      \n      items.push(itemObj);\n\n    }\n    \n    \n    if (platform === 'criteo') {    \n      \n      let itemObj = {\n        'id': arr[i][keyId],\n        'quantity': qt,\n        'price': arr[i][keyPr]\n      };\n          \n      items.push(itemObj);      \n      \n    }\n    \n    \n   if (platform === 'gAdsOff') {    \n      \n      items.push({\n        'productId': makeString(arr[i][keyId]),\n        'quantity': qt,\n        'unitPrice': makeNumber(arr[i][keyPr])\n      });\n    }\n    \n    \n    if (platform === 'pinterest') {\n      items.push({\n        'product_id': arr[i][keyId],\n        'product_name': arr[i][keyNm],\n        'product_quantity': qt,\n        'product_price': arr[i][keyPr] ? makeNumber(arr[i][keyPr]) : 0\n      });\n    }\n    \n    if (platform === 'rakuten') {\n      \n      //let p = arr[i][keyPr];\n      let p = toFixed2(makeNumber(arr[i][keyPr]));\n      let price;\n\n      if (data.taxPriceConfig === 'priceDeduct' && taxDeductPercent && taxDeductPercent > 0) {       \n        let tmp = p / ((taxDeductPercent / 100 ) + 1);\n        price = (math.round(tmp * 100) / 100) * 100 * qt;\n        price = math.round(price * 100) / 100;\n      }\n        \n        \n      if (data.discConfig === 'item_level' && arr[i][keyDisc]) {\n        let tmp;\n        let disc = makeNumber(arr[i][keyDisc]); //.replace(',','')\n        if (data.taxDiscountConfig == 'discDeduct' && taxDeductPercent && taxDeductPercent > 0) {\n          disc = disc / ((taxDeductPercent / 100) + 1);\n        }\n        \n        totalDiscount = toFixed2(makeNumber(totalDiscount) + toFixed2(disc));\n      \n      }\n\n\n      let itemObj = {\n        'sku': arr[i][keyId],\n        'product_name': arr[i][keyNm],\n        'quantity': qt,\n        'amount': price > 0 ? price : toFixed2(p * 100 * qt),\n        'optional_data': {}\n      };\n      \n      \n      if (keyCatList.length > 0) {\n        let catArr = [];\n        keyCatList.forEach(element => catArr.push(arr[i][element]));\n        itemObj.optional_data = { 'category': catArr.join(' > ') };   \n      } \n      \n      for (let prop in customParamMap) {\n        if (customParamMap[prop]) { \n          itemObj.optional_data[customParamMap[prop]] = arr[i][prop];\n        }\n      }   \n            \n      items.push(itemObj);\n    }\n    \n  } \n  \n  if (platform === 'rakuten' && totalDiscount > 0) {\n        \n      items.push({\n        'sku': \"Discount\",\n        'quantity': \"0\",\n        'amount': toFixed2(((totalDiscount - (totalDiscount * 2)) * 100)), \n        'product_name': \"Discount\"\n      });\n  }\n  \n  return items;\n}\n\n\nfunction getNumItems(arr) {\n\n  let num_items = 0;\n  \n  for (let i = 0; i < arr.length; i++) {\n    \n    if (arr[i][keyQt]) {\n    \n      if (getType(arr[i][keyQt]) === 'string')\n        num_items = num_items + makeInteger(arr[i][keyQt]);\n      else\n        num_items = num_items + arr[i][keyQt];\n    }\n    else\n      num_items = num_items + 1;\n    \n  }\n    \n  return num_items;\n}\n\n\nfunction getContentName(arr) {\n\n  let content_name = '';\n  \n  if (arr.length == 1)\n    content_name = arr[0][keyNm];\n  \n  return content_name;\n}\n\n\n___TESTS___\n\nscenarios: []\n\n\n___NOTES___\n\nCreated on 12/10/2021, 11:11:20\n\n\n",
                "galleryReference": {
                    "host": "github.com",
                    "owner": "stape-io",
                    "repository": "universal-conversions-variable",
                    "version": "b9490ec43859023e3bf045f852cdfffd9dcb8dcb",
                    "signature": "66465cc6bb6ce4dbd30464b9e4d5e8f9ee5f248f9b63cb2099dad19907dc4536"
                }
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "templateId": "254",
                "name": "Data Tag",
                "fingerprint": "1737718470787",
                "templateData": "___TERMS_OF_SERVICE___\n\nBy creating or modifying this file you agree to Google Tag Manager's Community\nTemplate Gallery Developer Terms of Service available at\nhttps://developers.google.com/tag-manager/gallery-tos (or such other URL as\nGoogle may provide), as modified from time to time.\n\n\n___INFO___\n\n{\n  \"type\": \"TAG\",\n  \"id\": \"cvt_temp_public_id\",\n  \"version\": 1,\n  \"securityGroups\": [],\n  \"displayName\": \"Data Tag\",\n  \"categories\": [\n    \"ANALYTICS\",\n    \"CONVERSIONS\"\n  ],\n  \"brand\": {\n    \"id\": \"github.com_stape-io\",\n    \"displayName\": \"stape-io\",\n    \"thumbnail\": \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAYAAAD0eNT6AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAABjkSURBVHgB7d1dclRXmi7gbymTEyei+kJnBK0aQcmBOFF3FiM4eATAbR8MYgSIEVgUct1aHgHUCFDdVXSJsGoEzh5B66I6oiOszNX5Q7txmR/tzJ2Za+39PBeAfUmIzHd/63vXTsHa5aODw5jEl5FjP1Lej5x2p/97NwBYSHE5/Yy8mv7+59iJ83RycR6sVQrWIh8d7sbk70+mP9BH4cseoKE0ipicx+DW83Tyl1HQOgGgZb74AVq2EyeRhi8EgXYJAC1ajPrTd5HzXgDQoulEIOeH6dTRQFt2glbkxwfPYhxvfPkDrMP0szXFm/lnLa0wAWjB/Acyx3EAsH4pjtMfLp4HKxEAVuTLH2ALhICVCQAryI/+771Ik1cBwObluGsnYHkCwJLy0e/3YjJ25g+wPVcxuP5tOrm8ChqzBLis65+OffkDbNVujAffBEsxAVjC/Ol/fP1jALB9jgKWYgKwjNnTPwBl2Mn3gsZMABrKR/vTkdPw3wOAUtgFWIIJQFPjW5ImQFl2fTY3JwA0lSeHAUBpvgwaEQCa2km/CwBKcxg0IgA0lWM/ACiMWnZTAkAD8/ofAEXyGd2MAAAAPSQAAEAPCQAA0EMCAAD0kAAAAD0kAABADwkAANBDAgAA9JAAAAA9JAAAQA8JAADQQwIAAPSQAABAJ6STv4yCGxMAAKhfisugEQEAgPrl+LegEQEAgA5Ir4NGBAAA6jcYnAeNCAAA1O5PFgCbEwAAqFuOk6AxAQCAmp2n04vzoDEBAIB6DYYPg6UIAABUKp85+1/eMACgOmk0ffp/HixNAACgPpP8Ir309L8KRwAAVCaN0rcXNv9XJAAAUBuj/xY4AgCgIvksvbw4C1ZmAgBAPQa3PP23RAAAoA45v1D7a48jAAAqkEYxHFr8a5EJAAA1eO7pv10CAACFS6P08q9nQasEAADKNo6vgtbZAQCgYPks/fHiMmidCQAA5VL7WxsBAIAyZYt/6yQAAFCgNEqnF8fB2ggAAJTI6H/NBAAACqP2twkCAABlGQzuBmsnAABQkHxm8W8zBAAASnGl9rc5AgAAZcjhbX8bJAAAUAC1v00TAAAogdH/hgkAAGzba7W/zRMAANiuwfBpsHECAABbpPa3LV4HDMCWpNH06d/Z/5aYAACwLd72t0UCAABb4L7/bRMAANi8PLH4t2UCAAAbls/S6dvXwVYJAABslvv+iyAAALA52eJfKdQAAdiQNIrh4CwoggkAAJvi6b8gAgAAG6D2VxoBAID1G8dXQVHsAACwZvks/fHiMiiKCQAA66X2VyQBAID1UfsrlgAAwJqkUTq9OA6KJAAAsC5G/wUTAABoX4pLtb+yCQAAtG9nqPZXOAEAgJblM4t/5XMPAAAtSqMYDJ39V8AEAID25Py9p/86CAAAtETtryYCAABtMfqviAAAQBteq/3VRQAAYHWD4dOgKgIAACtS+6uRGiAAK1D7q5UJAACr8La/SgkAACwpjSz+1UsAAGA5eWLxr2ICAABLyGfp9O3roFoCAADNDW5Z/KucAABAM9niXxeoAQLQQBrF8DcnQfVMAABoYvr0f34VVE8AAOCG1P66RAAA4GYGg7tBZwgAANyA+/67RgAA4PPU/jpHAADg09T+OkkAAOAT0iidXhwHnSMAAPApRv8dJQAA8DHnan/dJQAA8GGD4cOgswQAAD5A7a/rvAsAgH+QRtOnf2f/HScAAPBLk/wivfT033WOAAB4Txqlby+87a8HBAAA3mf03xOOAAB4J5+llxdnQS+YAACw4L7/XhEAAJg+/OcXan/94ggAoPfSKIZDi389YwIAgLf99ZAAANBraeS+/34SAAD6LGf3/feUHQCA3spn6fTtedBLJgAAfaX212sCAEAfZYt/fecIAKB3ZrW/36j99ZwJAED/TJ/+z6+CXhMAAHpF7Y8FAQCgTwaDuwEhAAD0SD6z+Md/EwAA+uFK7Y/3CQAAfZDD2/74BQEAoPPSKJ1eHAe8RwAA6D6jf35FAADotnO1Pz5EAADossHQ2/74IAEAoLPU/vg47wIA6KQ0mj79O/vnowQAgC6a5Bfppad/Ps4RAEDnpFH69sLb/vgkAQCge4z++SxHAACdks/Sy4uzgM8wAQDoEvf9c0MCAEBX5Oy+f27MEQBAJ6RRDIcW/7gxEwCAbnju6Z8mBACA6qWR+/5pSgAAqN04vgpoyA4AQNXyWfrjxWVAQyYAADVT+2NJAgBArbLFP5YnAABUKY3S6cVxwJIEAIA6Gf2zEgEAoDYpLtX+WJUAAFCbnaHaHysTAACqks8s/tEG9wAAVCONYjB09k8rTAAAapHz957+aYsAAFAFtT/aJQAA1MHon1YJAADle632R9sEAIDSDYZPA1omAAAUTe2P9VADBCiW2h/rYwIAUC5v+2NtBACAIqWRxT/WSQAAKFGeWPxjrQQAgOLks3T69nXAGgkAAKUZ3LL4x9oJAAAlyRb/2Aw1QIBipFEMB2cBG2ACAFAOT/9sjAAAUAS1PzZLAAAowTi+CtggOwAAW5fP0h8vLgM2yAQAYNvU/tgCAaCR/7wKgDap/bElKWgkP779Y+S0FwArmy/+/TZgC0wAmsrpbwHQDqN/tkYAaO48AFaV4lLtj20SAJoaDL2gA1jdzlDtj60SABp6t6xzHgBLy2cW/9g2AWAZ2bkdsKw0UvujBALAEtLpxXmYAgDLmOQXnv4pgQCwLFMAoLE0St9enAQUQABY0nwKkPOLALg5Dw4Uw0VAK8pfH7yZ/nYYAJ+Uz9LLtw8DCmECsKrB9VeR0igAPsXiH4URAFaUTi6vYmdwd3apRwB8kNof5XEE0KL86PbJdBrwJAB+Nqv9De4KAJTGBKBF6fTt0fTXh44EgPd42x9FMgFYk/zo4Hj6tzubBuwG0FPe9ke5TADWJJ1eHMdg+EXk/H0A/ZQnTwMKZQKwAfno93sxGb+ZhoG9AHpC7Y+yCQAblL++82D6N/5MEIAeGAx/6+yfkjkC2KD5u793fvrCNcLQcdniH+UzAdiS+bHA9U/HkdL9ADpkVvv7zRfp5PwqoGACwJblRweHsZO+cywAXZEezqd9UDgBoBD2A6AL1P6ohx2AQiz2AwZ3vWEQKjaY/huGSpgAFMh+ANRI7Y+6CAAFcywA1biaXfxl85+aCAAVyP//4CgG6YkgAIWa1f5mt39CRQSASjgWgFJZ/KNOlgArMRstptO3D2a3i01j22UApXCxF1UyAaiU/QAownl6eWHznyoJAJV799rhZwFsnvv+qZgjgMq9e+3wb712GDYtn/nyp2YmAB2S/+XOfgzjlWMBWLfZff+DuwIANRMAOsh+AKzZJJ6mby9OAiomAHTUojZ4/cB+ALRN7Y9usAPQUYvaoP0AWAO1PzrBBKAn8qPb92Jn5xvHArAK9/3THQJAz9gPgBWo/dEhjgB65r3XDjsWgCZyfuHLny4xAeix+aLg+Hq2yfz/AvgEtT+6RwDAsQB8Vno4n55BhwgA/Gx+rfBOui8IwPvU/ugmOwD8bF4btB8Av5SzrX86yQSAD5rvB0yuX0WO/YDeUvujuwQAPsl+AL2m9keHCQDciNcO0zs5ns+PxaCj7ABwI64Vpl/SKIb/5GU/dJoJAI157TDdp/ZH9wkALM1+AN2k9kc/OAJgae9dK/wioCsG059p6AETAFoxrw1e/3QcKd0PqJbaH/0hANAqxwJU7CoGwy/U/ugLAYC1EASojtofPSMAsDaOBaiHxT/6xxIgazMbpabTtw/m9wdE/CmgXM8DesYEgI1xLEChztPLC5v/9I4AwMa9u1b4yfSPuwHbluPu9Oz/PKBnBAC2wn4AhfD0T2/ZAWArfrEfkNIoYCuSd1vQWyYAFMF+AJtn859+MwGgCItrhX/6YtbFDtiIyXlAj5kAUBz7AWzEIH2RTv56GdBTAgDFcizA+hj/gyMAivXz2wZTeEqjZcb/IABQtHlb4A8XdgNoV3YzJQgAVGH+khYhgLYMb5kq0Xt2AKjKfC8g8ncBy7tKLy/+T0DPmQBQlfleQKSHAcvz9A8hAFAhIYCVpPy3AAQA6jQPAXYCWEq6CkAAoF7zxcCI1wFNZO+egBkBgLoNrh96mRCN5IkJAIQAQOXSyeVVTLJ9ABpwBAAzAgDVmx4FnEfOLwKAGxMA6Ibh+Hj6qyc7biDvBiAA0A3zo4BITwM+J+0IABACAB0yrwZaCAS4EQGAbnE3AJ+TvF4aZgQAOmVxS6BdAD4hp38OQACgg1JoBPBxKe8HIADQQTvXJwEfk2MvAAGA7lk0AuI84MN289Hv9wJ6TgCgq/4U8DHj63sBPScA0E2D67OAj0q/C+g5AYBOmh8DpLgM+KBsAkDvCQB0WP5zwIft5kcHhwE9JgDQXTmbAPBxKd0P6DEBgO4a/K/zgI/K9/LRvvcC0FsCAB32n24E5FN2YzI8CugpAYDOWiwC5lHAx2THAPSXAEDHJVMAPiHv5a/vPAjoIQGAbsvxbwGf9swuAH0kANBtOZsA8Bl5zy4AfSQAAOR44v0A9I0AADBrBIyvvwvoEQEAYOEwf33gKIDeEADotpT+OeDmnuV/ubMf0AMCAMD/2I1BvNIKoA8EALrO0xwNzVsBb4QAuk4AoLPefYD7EKe5PA2O48E3AR0mANBhQ0//rCA9yF/f1gygswQAumuc9gJWMgsBB3YC6CQBgO7Kk8OA1d2L8a0fXBRE1wgAdNfOzpcBrch7MR6/yY8ODgM6QgCgk+ZPa3n6oQ2tmf48pXiTHx88C+gAAYBuGo8PA9Yhx3H++s6PjgSonQBAR+X7AWszOxK4/nHWEhAEqFUK6Jj5B/L0wzlgM66mn6Qn6Q8XzwMqYgJA91z/dBywObs/Hwt8fedBQCVMAOiU+dP/ZPzGAiBbdB6D4cN08pdRQMFMAOiW2fKfL3+269B+ADUwAaAzPP1TnjSa/mS+SC8vTgIKYwJAd0yu7/vypyzzn8dv7AdQIhMAOsHmP3XIZzG49dx+ACUwAaAbbP5ThfRgvh/w5OAb+wFsmwkA1ctHB4cxjjcBVZntB8Tz9PKvZwFbIABQvfz4zo/O/qnXNAgM8sN0cnEesEECAFVbLFbl7wKqZz+AzRIAqJbaH52U4ti1wmyCJUDqla+f+PKnc1wrzIaYAFAltT/6YbYfMLjrWIB1MAGgTmp/9ILXDrM+JgBUx+IfPeW1w7RKAKA6an/0m/sDaIcAQFWmX/6zxT8vVoGI1zEYPrUfwLIEAKqh9gcf4v4AlmMJkHrMFv98+cM/mL1fYPxGbZCmTACogtof3EQaRZ48TadvXwd8hgkAdRhf2/qHz5pOyFJ6pTbITZgAUDy1P1hSiuPYGX5vP4APMQGgfCmeBdBcngYA+wF8hAkARcuPD57NP8SAFc2uFY6v0slfLwNCAKBg7xb/fpj+cTeAlqgNsuAIgHIt7vv35Q+tmtUGr3+cT9foNRMAiqT2B5vgWuE+EwAokvv+YYNSXMbO8CvHAv0iAFActT/YFvsBfSIAUJR8dLgbk//4wdM/bMv0WCDlM68d7j5LgJRl8vcnvvxhm6b//nIcTydxP7o/oNtMACiGxT8oktcOd5QJAOVY1P6Astyb1wa9X6BzTAAoQj66Pf2QSa8CKJjaYJcIABRB7Q9q4rXDXSAAsHVqf1ArtcGaCQBs1fxMcTJ+4+kfKua1w1WyBMh2zRb/fPlD3bx2uEomAGyN2h900ey1w4O7pgHlMwFge9T+oIPyntpgHUwA2AqLf9ATKY5dK1wmAYCtUPuDPnF/QIkEADYuPz54Nl8aAvrFa4eLIgCwUWp/gPsDymAJkM1S+wMiPVjUBg+Ogq0xAWBj1P6AX7MfsC0mAGzO5NrLfoB/MJsI5u/UBjfPBICNUPsDbmQnTiINX9gPWD8TADYjxbMA+JxJHLlWeDNMAFg7tT9gObNrhfPDdHJxHrROAGCtLP4Bq1MbXAdHAKyX+/6Blc1qg9c/qA22ywSAtclHd/ZjnH8IgLZ4t0BrTABYn0mo/QHtynE8qwwGKxMAWIv5Bq8b/4C1SA/yk4NvgpU4AqB17vsHNuRpenlxEizFBID2Ta7v+/IHNuCZ2wOXJwDQqvk/Rp1/YDN2Y3xtH2BJAgDtUvsDNuswPzo4DBoTAGhNPrp9L1K6HwCb5KrxpQgAtGeyYysX2IbDfLS/GzQiANAKtT9gq8a37gWNCACsbL74ZwQHbNeXQSMCAKubLf55+ge26zBoRABgJYunf4t/wLZ5CGlKAGA142uLf0ARXArUjADA0uaLfxEWbwAqJACwPIt/ANUSAFhKfnzwzOIfQL0EABpbnLOlBwFAtQQAmlP7A6ieAEAjan8A3SAA0Mzk+lUAUD0BgBtb3Pcf+wFA9QQAbk7tD6AzBABuRO0PoFsEAD5rvviX4zgA6AwBgM+b1f4A6BQBgE/KR3f21f4AukcA4NMmofYH0EECAB+1qP1Z/APoIgGAD1rc+Kf2B9BVw4APyddPIsdeANBJJgD8yvzpfxJHAUBnCQD8mtofQOc5AuAX5ot/kdX+ADrOBIBfsvgH0AsCAD/Lj+88UfsD6AcBgLn54l9Y/APoCwGAhdnin6d/gN4QAHh36Y/7/gH6RAAgYnz9XQDQKwJAzy1qf3EYAPSKANB3an8AvSQA9Fh+fPDM4h9APwkAPTVf/MtqfwB9JQD01eK+/90AoJcEgB5S+wNAAOijyfhNANBrAkDPzGt/Fv8Aek8A6JF8dLir9gfAzDDoj8nfn0SOvQCg90wAeuJd7e84ACAEgP5Y1P4AYE4A6IF8dHCo9gfA+wSAPpgkb/sD4BcEgI5T+wPgQwSADlvc+Kf2B8CvqQF2Wb5W+wPgg0wAOmr+9D/xtj8APkwA6Cq1PwA+wRFAB80X/yKr/QHwUSYAXWTxD4DPEAA6Jj++80TtD4DPEQA6ZL74Fxb/APg8AaBLZot/nv4BuAEBoCMWl/647x+AmxEAumJ87b5/AG5MAOiARe0vDgMAbkgA6AK1PwAaEgAqlx8fPLP4B0BTAkDF5ot/OY4DABoSAGrmvn8AliQAVErtD4BVCAC1mozfBAAsSQCo0Lz2Z/EPgBUIAJXJR4e7an8ArGoY1GXy9yeRYy8AYAUmABVR+wOgLQJATdT+AGiJAFCJfHT7ntofAG0RAGox2fkmAKAlAkAF1P4AaJsAULjFjX9qfwC0SwAo3Wzxz9M/AC0TAArmvn8A1kUAKNn42uIfAGshABRqvvgXcS8AYA0EgFJZ/ANgjQSAAuXHB88s/gGwTgJAYeaLf5EeBACskQBQGrU/ADZAACiI2h8AmyIAlGRy/SoAYAMEgEIs7vuP/QCADRAASqH2B8AGCQAFUPsDYNMEgC2bL/7lOA4A2CABYNtmtT8A2DABYIvy0Z19tT8AtkEA2KZJqP0BsBUCwJYsan8W/wDYDgFgCxY3/qn9AbA9w2DzJtf3I8deAMCWmABsmNofACUQADZN7Q+AAggAG5SPbt9T+wOgBALAJk12vgkAKIAAsCFqfwCURADYALU/AEojAGzCbPHP0z8ABREA1mzx9G/xD4CyCADrNr62+AdAcQSANZov/kXcCwAojACwThb/ACiUALAm+fHBM4t/AJRKAFiDd/f9HwUAFEoAWIfFff+7AQCFEgBapvYHQA0EgLZNxm8CAAonALTIff8A1EIAaJPaHwCVEABaovYHQE0EgBa8q/0dBwBUQgBow6L2BwDVEABWlI/u7Kv9AVAbAWBVk3gVAFAZAWAFan8A1EoAWNLixj+1PwDqNAyWk6+fRI69AIAKmQAsYf70P/G2PwDqJQAsQ+0PgMoJAMvY2fkyAKBiAkBD+dHtezb/AaidANDcvQCAygkATe2k3wUAVE4AaCrHfgBA5QSABvLR/m4AQAcIAI38bwEAgE4QAACghwQAAOghAQAAekgAAIAeEgAAoIcEAADoIQEAAHpIAACAHhIAAKCHBAAA6CEBAAB6SAAAgB4SAACghwQAAOghAQAAekgAAIAeEgAAoIcEAADoIQEAAHpIAACAHhIAAKCHBAAA6KEUNJK/PsgBQHHSywvfaQ2YADSV8igAKEuKy6ARAaCpSfw5AChLzgJAQwJAUymfBwCF2fFw1pAA0NRg8nr661UAUI7BT6+DRgSAhtLJ5dV0CvB9AFCIfDb/bKYRAWAZkyRpApRicOt50JgAsIR0enEe2RQAYPtmT/9/GQWNCQDLGo6Pwi4AwBalkaf/5QkAS5qfN+X4KgDYjpyeevpfngCwgsVRQEifAJs2/exNp/9qH2sFrk1sQX50cDz9m3wWAKzf/Mv/4jhYiQDQEiEAYAN8+bdGAGjRNAQcxk76LnLeCwBalEbTz9aH86NXWmEHoEXzH8ydwd3pD+mLAKANV/Ndq8FvvvDl3y4TgDXJR7/fi+ufjmNn50sTAYDGZl/8L2L4Tyfp5Fzleg0EgA1YHA3E4fSH+cvp3/ju9Pf9AOC/za5Yn37hp8vp5+Pfpv997ml//f4L3vH+OAZ8xYAAAAAASUVORK5CYII\\u003d\"\n  },\n  \"description\": \"Use this tag for sending data to the Server Container.\",\n  \"containerContexts\": [\n    \"WEB\"\n  ]\n}\n\n\n___TEMPLATE_PARAMETERS___\n\n[\n  {\n    \"type\": \"RADIO\",\n    \"name\": \"event_type\",\n    \"displayName\": \"Event Name\",\n    \"radioItems\": [\n      {\n        \"value\": \"standard\",\n        \"displayValue\": \"Standard\",\n        \"subParams\": [\n          {\n            \"type\": \"SELECT\",\n            \"name\": \"event_name_standard\",\n            \"selectItems\": [\n              {\n                \"value\": \"page_view\",\n                \"displayValue\": \"Page View\"\n              },\n              {\n                \"value\": \"add_payment_info\",\n                \"displayValue\": \"Add Payment Info\"\n              },\n              {\n                \"value\": \"add_to_cart\",\n                \"displayValue\": \"Add To Cart\"\n              },\n              {\n                \"value\": \"add_to_wishlist\",\n                \"displayValue\": \"Add To Wishlist\"\n              },\n              {\n                \"value\": \"begin_checkout\",\n                \"displayValue\": \"Begin Checkout\"\n              },\n              {\n                \"value\": \"contact\",\n                \"displayValue\": \"Contact\"\n              },\n              {\n                \"value\": \"customize_product\",\n                \"displayValue\": \"Customize Product\"\n              },\n              {\n                \"value\": \"donate\",\n                \"displayValue\": \"Donate\"\n              },\n              {\n                \"value\": \"exception\",\n                \"displayValue\": \"Exception\"\n              },\n              {\n                \"value\": \"find_location\",\n                \"displayValue\": \"Find Location\"\n              },\n              {\n                \"value\": \"generate_lead\",\n                \"displayValue\": \"Generate Lead\"\n              },\n              {\n                \"value\": \"join_group\",\n                \"displayValue\": \"Join Group\"\n              },\n              {\n                \"value\": \"login\",\n                \"displayValue\": \"Login\"\n              },\n              {\n                \"value\": \"purchase\",\n                \"displayValue\": \"Purchase\"\n              },\n              {\n                \"value\": \"refund\",\n                \"displayValue\": \"Refund\"\n              },\n              {\n                \"value\": \"schedule\",\n                \"displayValue\": \"Schedule\"\n              },\n              {\n                \"value\": \"search\",\n                \"displayValue\": \"Search\"\n              },\n              {\n                \"value\": \"select_content\",\n                \"displayValue\": \"Select Content\"\n              },\n              {\n                \"value\": \"share\",\n                \"displayValue\": \"Share\"\n              },\n              {\n                \"value\": \"sign_up\",\n                \"displayValue\": \"Sign Up\"\n              },\n              {\n                \"value\": \"start_trial\",\n                \"displayValue\": \"Start Trial\"\n              },\n              {\n                \"value\": \"submit_application\",\n                \"displayValue\": \"Submit Application\"\n              },\n              {\n                \"value\": \"subscribe\",\n                \"displayValue\": \"Subscribe\"\n              },\n              {\n                \"value\": \"view_item\",\n                \"displayValue\": \"View Item\"\n              },\n              {\n                \"value\": \"view_item_list\",\n                \"displayValue\": \"View Item List\"\n              },\n              {\n                \"value\": \"view_search_results\",\n                \"displayValue\": \"View Search Results\"\n              }\n            ],\n            \"simpleValueType\": true,\n            \"defaultValue\": \"page_view\",\n            \"alwaysInSummary\": true\n          }\n        ]\n      },\n      {\n        \"value\": \"custom\",\n        \"displayValue\": \"Custom\",\n        \"subParams\": [\n          {\n            \"type\": \"TEXT\",\n            \"name\": \"event_name_custom\",\n            \"simpleValueType\": true\n          }\n        ]\n      }\n    ],\n    \"simpleValueType\": true\n  },\n  {\n    \"type\": \"TEXT\",\n    \"name\": \"gtm_server_domain\",\n    \"displayName\": \"GTM Server Side URL\",\n    \"simpleValueType\": true,\n    \"help\": \"Domain to where the tag will send requests. For example https://gtm.example.com\",\n    \"valueValidators\": [\n      {\n        \"type\": \"NON_EMPTY\"\n      },\n      {\n        \"type\": \"REGEX\",\n        \"args\": [\n          \"^(https://).*\"\n        ],\n        \"errorMessage\": \"URL must start with https://\"\n      }\n    ],\n    \"alwaysInSummary\": true\n  },\n  {\n    \"type\": \"CHECKBOX\",\n    \"name\": \"add_data_layer\",\n    \"checkboxText\": \"Send all from DataLayer\",\n    \"simpleValueType\": true,\n    \"help\": \"Adds all Data Layer values to the request\"\n  },\n  {\n    \"type\": \"CHECKBOX\",\n    \"name\": \"add_common\",\n    \"checkboxText\": \"Send common data\",\n    \"simpleValueType\": true,\n    \"help\": \"Adds to request page_location, page_path, page_hostname, page_referrer, page_title, page_encoding, screen_resolution, viewport_size\",\n    \"defaultValue\": true\n  },\n  {\n    \"type\": \"CHECKBOX\",\n    \"name\": \"add_consent_state\",\n    \"checkboxText\": \"Add consent state\",\n    \"simpleValueType\": true,\n    \"help\": \"Adds \\u003cb\\u003econsent_state\\u003c/b\\u003e object to request.\\u003cbr/\\u003e\\nIncluding following properties:\\u003cbr/\\u003e \\nad_storage\\u003cbr/\\u003e\\nad_user_data\\u003cbr/\\u003e\\nad_personalization\\u003cbr/\\u003e\\nanalytics_storage\\u003cbr/\\u003e\\nfunctionality_storage\\u003cbr/\\u003e\\npersonalization_storage\\u003cbr/\\u003e\\nsecurity_storage\"\n  },\n  {\n    \"type\": \"CHECKBOX\",\n    \"name\": \"add_common_cookie\",\n    \"checkboxText\": \"Add Common Cookie\",\n    \"simpleValueType\": true,\n    \"help\": \"The tag will send common cookies in eventData to avoid some e-commerce platform limitations. Now supported by the next Stape tags: \\u003cbr /\\u003e\\n\\u003ca href\\u003d\\\"https://tagmanager.google.com/gallery/#/owners/stape-io/templates/facebook-tag\\\" target\\u003d\\\"_blank\\\"\\u003eFacebook Conversion API\\u003c/a\\u003e\\u003cbr /\\u003e\\n\\u003ca href\\u003d\\\"https://tagmanager.google.com/gallery/#/owners/stape-io/templates/tiktok-tag\\\" target\\u003d\\\"_blank\\\"\\u003eTikTok Events API\\u003c/a\\u003e\\u003cbr /\\u003e\\n\\u003ca href\\u003d\\\"https://github.com/stape-io/pinterest-tag\\\" target\\u003d\\\"_blank\\\"\\u003ePinterest Conversion API\\u003c/a\\u003e\\u003cbr /\\u003e\\n\\u003ca href\\u003d\\\"https://tagmanager.google.com/gallery/#/owners/stape-io/templates/snapchat-tag\\\" target\\u003d\\\"_blank\\\"\\u003eSnapchat Conversion API\\u003c/a\\u003e\\u003cbr /\\u003e\\n\\u003ca href\\u003d\\\"https://tagmanager.google.com/gallery/#/owners/stape-io/templates/taboola-tag\\\" target\\u003d\\\"_blank\\\"\\u003eTaboola\\u003c/a\\u003e\\u003c/br\\u003e\\n\\u003ca href\\u003d\\\"https://tagmanager.google.com/gallery/#/owners/stape-io/templates/awin-tag\\\" target\\u003d\\\"_blank\\\"\\u003eAwin\\u003c/a\\u003e\\u003c/br\\u003e\\n\\u003ca href\\u003d\\\"https://tagmanager.google.com/gallery/#/owners/stape-io/templates/rakuten-tag\\\" target\\u003d\\\"_blank\\\"\\u003eRakuten\\u003c/a\\u003e\\u003c/br\\u003e\\n\\u003ca href\\u003d\\\"https://tagmanager.google.com/gallery/#/owners/stape-io/templates/klaviyo-tag\\\" target\\u003d\\\"_blank\\\"\\u003eKlaviyo\\u003c/a\\u003e\\u003c/br\\u003e\\n\\u003ca href\\u003d\\\"https://tagmanager.google.com/gallery/#/owners/stape-io/templates/outbrain-tag\\\" target\\u003d\\\"_blank\\\"\\u003eOutbrain\\u003c/a\\u003e\\u003c/br\\u003e\"\n  },\n  {\n    \"type\": \"GROUP\",\n    \"name\": \"custom\",\n    \"displayName\": \"Event Data\",\n    \"groupStyle\": \"ZIPPY_CLOSED\",\n    \"subParams\": [\n      {\n        \"type\": \"SIMPLE_TABLE\",\n        \"name\": \"custom_data\",\n        \"displayName\": \"\",\n        \"simpleTableColumns\": [\n          {\n            \"defaultValue\": \"\",\n            \"displayName\": \"Name\",\n            \"name\": \"name\",\n            \"type\": \"TEXT\",\n            \"valueValidators\": [\n              {\n                \"type\": \"NON_EMPTY\"\n              }\n            ]\n          },\n          {\n            \"defaultValue\": \"\",\n            \"displayName\": \"Value\",\n            \"name\": \"value\",\n            \"type\": \"TEXT\"\n          },\n          {\n            \"defaultValue\": \"none\",\n            \"displayName\": \"Transformation\",\n            \"name\": \"transformation\",\n            \"type\": \"SELECT\",\n            \"selectItems\": [\n              {\n                \"value\": \"none\",\n                \"displayValue\": \"None\"\n              },\n              {\n                \"value\": \"trim\",\n                \"displayValue\": \"Trim\"\n              },\n              {\n                \"value\": \"to_lower_case\",\n                \"displayValue\": \"To lower case\"\n              },\n              {\n                \"value\": \"md5\",\n                \"displayValue\": \"MD5 hash\"\n              },\n              {\n                \"value\": \"base64\",\n                \"displayValue\": \"Base64\"\n              },\n              {\n                \"value\": \"sha256base64\",\n                \"displayValue\": \"SHA-256 digest (Base64 encoded)\"\n              },\n              {\n                \"value\": \"sha256hex\",\n                \"displayValue\": \"SHA-256 digest (HEX encoded)\"\n              }\n            ],\n            \"valueValidators\": [\n              {\n                \"type\": \"NON_EMPTY\"\n              }\n            ]\n          },\n          {\n            \"defaultValue\": \"none\",\n            \"displayName\": \"Store\",\n            \"name\": \"store\",\n            \"type\": \"SELECT\",\n            \"selectItems\": [\n              {\n                \"value\": \"none\",\n                \"displayValue\": \"None\"\n              },\n              {\n                \"value\": \"all\",\n                \"displayValue\": \"Everywhere\"\n              },\n              {\n                \"value\": \"localStorage\",\n                \"displayValue\": \"Local Storage\"\n              },\n              {\n                \"value\": \"cookies\",\n                \"displayValue\": \"Cookies\"\n              }\n            ],\n            \"valueValidators\": [\n              {\n                \"type\": \"NON_EMPTY\"\n              }\n            ]\n          }\n        ]\n      }\n    ]\n  },\n  {\n    \"type\": \"GROUP\",\n    \"name\": \"user\",\n    \"displayName\": \"User Data\",\n    \"groupStyle\": \"ZIPPY_CLOSED\",\n    \"subParams\": [\n      {\n        \"type\": \"SIMPLE_TABLE\",\n        \"name\": \"user_data\",\n        \"displayName\": \"\",\n        \"simpleTableColumns\": [\n          {\n            \"defaultValue\": \"email_address\",\n            \"displayName\": \"Name\",\n            \"name\": \"name\",\n            \"type\": \"SELECT\",\n            \"valueValidators\": [\n              {\n                \"type\": \"NON_EMPTY\"\n              }\n            ],\n            \"isUnique\": true,\n            \"selectItems\": [\n              {\n                \"value\": \"email_address\",\n                \"displayValue\": \"Email Address\"\n              },\n              {\n                \"value\": \"phone_number\",\n                \"displayValue\": \"Phone Number\"\n              },\n              {\n                \"value\": \"first_name\",\n                \"displayValue\": \"First Name\"\n              },\n              {\n                \"value\": \"last_name\",\n                \"displayValue\": \"Last Name\"\n              },\n              {\n                \"value\": \"gender\",\n                \"displayValue\": \"Gender\"\n              },\n              {\n                \"value\": \"db\",\n                \"displayValue\": \"Date of Birth\"\n              },\n              {\n                \"value\": \"street\",\n                \"displayValue\": \"Street\"\n              },\n              {\n                \"value\": \"city\",\n                \"displayValue\": \"City\"\n              },\n              {\n                \"value\": \"region\",\n                \"displayValue\": \"Region\"\n              },\n              {\n                \"value\": \"postal_code\",\n                \"displayValue\": \"Postal Code\"\n              },\n              {\n                \"value\": \"country\",\n                \"displayValue\": \"Country\"\n              },\n              {\n                \"value\": \"user_id\",\n                \"displayValue\": \"User ID\"\n              }\n            ]\n          },\n          {\n            \"defaultValue\": \"\",\n            \"displayName\": \"Value\",\n            \"name\": \"value\",\n            \"type\": \"TEXT\"\n          },\n          {\n            \"defaultValue\": \"none\",\n            \"displayName\": \"Transformation\",\n            \"name\": \"transformation\",\n            \"type\": \"SELECT\",\n            \"selectItems\": [\n              {\n                \"value\": \"none\",\n                \"displayValue\": \"None\"\n              },\n              {\n                \"value\": \"trim\",\n                \"displayValue\": \"Trim\"\n              },\n              {\n                \"value\": \"to_lower_case\",\n                \"displayValue\": \"To lower case\"\n              },\n              {\n                \"value\": \"md5\",\n                \"displayValue\": \"MD5 hash\"\n              },\n              {\n                \"value\": \"base64\",\n                \"displayValue\": \"Base64\"\n              },\n              {\n                \"value\": \"sha256base64\",\n                \"displayValue\": \"SHA-256 digest (Base64 encoded)\"\n              },\n              {\n                \"value\": \"sha256hex\",\n                \"displayValue\": \"SHA-256 digest (HEX encoded)\"\n              }\n            ],\n            \"valueValidators\": [\n              {\n                \"type\": \"NON_EMPTY\"\n              }\n            ]\n          },\n          {\n            \"defaultValue\": \"none\",\n            \"displayName\": \"Store\",\n            \"name\": \"store\",\n            \"type\": \"SELECT\",\n            \"selectItems\": [\n              {\n                \"value\": \"none\",\n                \"displayValue\": \"None\"\n              },\n              {\n                \"value\": \"all\",\n                \"displayValue\": \"Everywhere\"\n              },\n              {\n                \"value\": \"localStorage\",\n                \"displayValue\": \"Local Storage\"\n              },\n              {\n                \"value\": \"cookies\",\n                \"displayValue\": \"Cookies\"\n              }\n            ],\n            \"valueValidators\": [\n              {\n                \"type\": \"NON_EMPTY\"\n              }\n            ]\n          }\n        ]\n      }\n    ]\n  },\n  {\n    \"type\": \"GROUP\",\n    \"name\": \"settings\",\n    \"displayName\": \"Settings\",\n    \"groupStyle\": \"ZIPPY_CLOSED\",\n    \"subParams\": [\n      {\n        \"type\": \"SELECT\",\n        \"name\": \"request_type\",\n        \"displayName\": \"Request type\",\n        \"macrosInSelect\": false,\n        \"selectItems\": [\n          {\n            \"value\": \"auto\",\n            \"displayValue\": \"Auto\"\n          },\n          {\n            \"value\": \"post\",\n            \"displayValue\": \"POST\"\n          },\n          {\n            \"value\": \"get\",\n            \"displayValue\": \"GET\"\n          }\n        ],\n        \"simpleValueType\": true,\n        \"defaultValue\": \"auto\",\n        \"valueValidators\": [\n          {\n            \"type\": \"NON_EMPTY\"\n          }\n        ],\n        \"help\": \"We highly recommend using \\u003cb\\u003eAuto\\u003c/b\\u003e. Change this only if you know what you do.\"\n      },\n      {\n        \"type\": \"TEXT\",\n        \"name\": \"request_path\",\n        \"displayName\": \"Path\",\n        \"simpleValueType\": true,\n        \"defaultValue\": \"/data\",\n        \"help\": \"The path used for sending requests to the GTM Server Side container. If you use Data client on GTM Server Side Path should be \\u003cb\\u003e/data\\u003c/b\\u003e\",\n        \"valueValidators\": [\n          {\n            \"type\": \"NON_EMPTY\"\n          }\n        ]\n      },\n      {\n        \"type\": \"TEXT\",\n        \"name\": \"protocol_version\",\n        \"displayName\": \"Protocol version\",\n        \"simpleValueType\": true,\n        \"defaultValue\": 2,\n        \"help\": \"Protocol version that used for sending a request to Data client on GTM Server Side.\",\n        \"valueValidators\": [\n          {\n            \"type\": \"NON_EMPTY\"\n          }\n        ]\n      },\n      {\n        \"type\": \"TEXT\",\n        \"name\": \"data_tag_load_script_url\",\n        \"displayName\": \"Data Tag Script URL\",\n        \"simpleValueType\": true,\n        \"help\": \"Url, where to load data tag script from, by default will be loaded from https://stapecdn.com/dtag/${data-script-version}.js. This can be parameterized with ${data-script-version} in order to load the correct version for this tag.\",\n        \"valueValidators\": [\n          {\n            \"type\": \"REGEX\",\n            \"args\": [\n              \"^(https://).*(\\\\.js)$\"\n            ]\n          }\n        ],\n        \"alwaysInSummary\": false,\n        \"defaultValue\": \"https://stapecdn.com/dtag/v8.js\"\n      },\n      {\n        \"type\": \"CHECKBOX\",\n        \"name\": \"addGaParameters\",\n        \"checkboxText\": \"Add GA4 specific parameters\",\n        \"simpleValueType\": true,\n        \"help\": \"Adds specific parameters for the server GA4 tag.\",\n        \"defaultValue\": false,\n        \"enablingConditions\": [\n          {\n            \"paramName\": \"request_type\",\n            \"paramValue\": \"post\",\n            \"type\": \"EQUALS\"\n          }\n        ]\n      },\n      {\n        \"type\": \"TEXT\",\n        \"name\": \"gaId\",\n        \"displayName\": \"Measurement ID\",\n        \"simpleValueType\": true,\n        \"enablingConditions\": [\n          {\n            \"paramName\": \"addGaParameters\",\n            \"paramValue\": true,\n            \"type\": \"EQUALS\"\n          }\n        ],\n        \"valueHint\": \"G-ABCD123456\",\n        \"valueValidators\": [\n          {\n            \"type\": \"NON_EMPTY\"\n          }\n        ],\n        \"help\": \"Enter the Measurement ID of your GA4 property.\"\n      },\n      {\n        \"type\": \"CHECKBOX\",\n        \"name\": \"dataLayerEventPush\",\n        \"checkboxText\": \"Push event to DataLayer after tag receives a response\",\n        \"simpleValueType\": true,\n        \"help\": \"Helpful in obtaining data from the server.\",\n        \"defaultValue\": false\n      },\n      {\n        \"type\": \"TEXT\",\n        \"name\": \"dataLayerEventName\",\n        \"displayName\": \"DataLayer Event Name\",\n        \"simpleValueType\": true,\n        \"enablingConditions\": [\n          {\n            \"paramName\": \"dataLayerEventPush\",\n            \"paramValue\": true,\n            \"type\": \"EQUALS\"\n          }\n        ],\n        \"valueValidators\": [\n          {\n            \"type\": \"NON_EMPTY\"\n          }\n        ],\n        \"valueHint\": \"page_view_response\"\n      },\n      {\n        \"type\": \"TEXT\",\n        \"name\": \"dataLayerVariableName\",\n        \"displayName\": \"DataLayer Object Name\",\n        \"simpleValueType\": true,\n        \"enablingConditions\": [\n          {\n            \"paramName\": \"dataLayerEventPush\",\n            \"paramValue\": true,\n            \"type\": \"EQUALS\"\n          }\n        ],\n        \"valueValidators\": [\n          {\n            \"type\": \"NON_EMPTY\"\n          }\n        ],\n        \"defaultValue\": \"dataLayer\",\n        \"help\": \"Use dataLayer by default. Modify only if you renamed dataLayer object name.\"\n      },\n      {\n        \"type\": \"CHECKBOX\",\n        \"name\": \"richsstsse\",\n        \"checkboxText\": \"Support rich command protocol\",\n        \"simpleValueType\": true,\n        \"enablingConditions\": [\n          {\n            \"paramName\": \"request_type\",\n            \"paramValue\": \"get\",\n            \"type\": \"NOT_EQUALS\"\n          }\n        ],\n        \"help\": \"Useful if you have server-side tags, that (partially) depend on the sendPixelFromBrowser() api for 3rd party cookies (e.g. Google Ads Conversion, Google Ads Remarketing)\",\n        \"defaultValue\": false\n      },\n      {\n        \"type\": \"CHECKBOX\",\n        \"name\": \"waitForCookies\",\n        \"checkboxText\": \"Wait for cookies before event is pushed\",\n        \"simpleValueType\": true,\n        \"defaultValue\": false,\n        \"enablingConditions\": [\n          {\n            \"paramName\": \"richsstsse\",\n            \"paramValue\": true,\n            \"type\": \"EQUALS\"\n          }\n        ],\n        \"help\": \"Wait for all cookies to be set before event is pushed to DataLayer. Helpful if a server-side tag sets cookies that a web tag relies on.\"\n      },\n      {\n        \"type\": \"CHECKBOX\",\n        \"name\": \"useFetchInsteadOfXHR\",\n        \"checkboxText\": \"Use fetch instead of XMLHttpRequest\",\n        \"simpleValueType\": true,\n        \"enablingConditions\": [],\n        \"help\": \"Using fetch with keepalive option which allow the request to outlive the page. \\u003ca href\\u003d\\\"https://developer.mozilla.org/en-US/docs/Web/API/fetch#keepalive\\\"\\u003eRead more\\u003c/a\\u003e\"\n      }\n    ]\n  }\n]\n\n\n___SANDBOXED_JS_FOR_WEB_TEMPLATE___\n\nconst copyFromDataLayer = require('copyFromDataLayer');\nconst JSON = require('JSON');\nconst getUrl = require('getUrl');\nconst getReferrerUrl = require('getReferrerUrl');\nconst readTitle = require('readTitle');\nconst injectScript = require('injectScript');\nconst callInWindow = require('callInWindow');\nconst makeNumber = require('makeNumber');\nconst readCharacterSet = require('readCharacterSet');\nconst localStorage = require('localStorage');\nconst sendPixel = require('sendPixel');\nconst encodeUriComponent = require('encodeUriComponent');\nconst toBase64 = require('toBase64');\nconst makeString = require('makeString');\nconst setCookie = require('setCookie');\nconst getCookieValues = require('getCookieValues');\nconst getContainerVersion = require('getContainerVersion');\nconst isConsentGranted = require('isConsentGranted');\n\nlet pageLocation = getUrl();\n\nif (\n  pageLocation &&\n  pageLocation.lastIndexOf('https://gtm-msr.appspot.com/', 0) === 0\n) {\n  data.gtmOnSuccess();\n\n  return;\n}\nconst userAndCustomData = getUserAndCustomDataArray();\nlet requestType = determinateRequestType();\n\nif (requestType === 'post') {\n  const dataScriptVersion = 'v8';\n  const dataTagScriptUrl =\n    typeof data.data_tag_load_script_url !== 'undefined'\n      ? data.data_tag_load_script_url.replace(\n          '${data-script-version}',\n          dataScriptVersion\n        )\n      : 'https://stapecdn.com/dtag/' + dataScriptVersion + '.js';\n  injectScript(\n    dataTagScriptUrl,\n    sendPostRequest,\n    data.gtmOnFailure,\n    dataTagScriptUrl\n  );\n} else {\n  sendGetRequest();\n}\n\nfunction sendPostRequest() {\n  let eventData = {};\n\n  eventData = addCommonDataForPostRequest(data, eventData);\n  eventData = addRequiredDataForPostRequest(data, eventData);\n  eventData = addGaRequiredData(data, eventData);\n\n  callInWindow(\n    'dataTagSendData',\n    eventData,\n    data.gtm_server_domain,\n    data.request_path +\n      '?v=' +\n      eventData.v +\n      '&event_name=' +\n      encodeUriComponent(eventData.event_name) +\n      (data.richsstsse ? '&richsstsse' : ''),\n    data.dataLayerEventName,\n    data.dataLayerVariableName,\n    data.waitForCookies,\n    data.useFetchInsteadOfXHR\n  );\n\n  data.gtmOnSuccess();\n}\n\nfunction sendGetRequest() {\n  sendPixel(\n    addDataForGetRequest(data, buildEndpoint()),\n    data.gtmOnSuccess,\n    data.gtmOnFailure\n  );\n}\n\nfunction buildEndpoint() {\n  return data.gtm_server_domain + data.request_path;\n}\n\nfunction addRequiredDataForPostRequest(data, eventData) {\n  eventData.event_name = getEventName(data);\n  eventData.v = makeNumber(data.protocol_version);\n\n  let customData = getCustomData(data, true);\n\n  for (let key in customData) {\n    eventData[customData[key].name] = customData[key].value;\n  }\n\n  return eventData;\n}\n\nfunction addGaRequiredData(data, eventData) {\n  if (data.addGaParameters && data.gaId) {\n    eventData['x-ga-measurement_id'] = data.gaId;\n    eventData['x-ga-page_id'] = copyFromDataLayer('gtm.start');\n    eventData['x-ga-mp2-richsstsse'] = '';\n    eventData['x-ga-mp2-seg'] = 1;\n    eventData['x-ga-request_count'] = 1;\n    eventData['x-ga-protocol_version'] = 2;\n    eventData.v = 2;\n  }\n\n  return eventData;\n}\n\nfunction addDataForGetRequest(data, url) {\n  let eventData = {};\n  url +=\n    '?v=' +\n    data.protocol_version +\n    '&event_name=' +\n    encodeUriComponent(getEventName(data));\n\n  if (data.add_common) {\n    eventData = addCommonData(data, eventData);\n  }\n\n  if (data.add_consent_state) {\n    eventData = addConsentStateData(eventData);\n  }\n\n  if (data.add_common_cookie) {\n    eventData = addCommonCookie(eventData);\n  }\n\n  let customData = getCustomData(data, false);\n\n  if (customData.length) {\n    for (let customDataKey in customData) {\n      eventData[customData[customDataKey].name] =\n        customData[customDataKey].value;\n    }\n  }\n\n  if (data.request_type === 'auto') {\n    return (\n      url + '&dtdc=' + encodeUriComponent(toBase64(JSON.stringify(eventData)))\n    );\n  }\n\n  for (let eventDataKey in eventData) {\n    url +=\n      '&' +\n      eventDataKey +\n      '=' +\n      (eventData[eventDataKey]\n        ? encodeUriComponent(eventData[eventDataKey])\n        : '');\n  }\n\n  return url;\n}\n\nfunction addCommonDataForPostRequest(data, eventData) {\n  if (data.add_common || data.add_data_layer) {\n    const dataTagData = callInWindow(\n      'dataTagGetData',\n      getContainerVersion()['containerId']\n    );\n\n    if (data.add_data_layer && dataTagData.dataModel) {\n      for (let dataKey in dataTagData.dataModel) {\n        eventData[dataKey] = dataTagData.dataModel[dataKey];\n      }\n    }\n\n    if (data.add_common) {\n      eventData = addCommonData(data, eventData);\n      eventData.screen_resolution =\n        dataTagData.screen.width + 'x' + dataTagData.screen.height;\n      eventData.viewport_size =\n        dataTagData.innerWidth + 'x' + dataTagData.innerHeight;\n    }\n  }\n  if (data.add_consent_state) {\n    eventData = addConsentStateData(eventData);\n  }\n\n  if (data.add_common_cookie) {\n    eventData = addCommonCookie(eventData);\n  }\n\n  return eventData;\n}\n\nfunction addCommonData(data, eventData) {\n  eventData.page_location = getUrl();\n  eventData.page_hostname = getUrl('host');\n  eventData.page_referrer = getReferrerUrl();\n  eventData.page_title = readTitle();\n  eventData.page_encoding = readCharacterSet();\n\n  return eventData;\n}\n\nfunction addConsentStateData(eventData) {\n  eventData.consent_state = {\n    ad_storage: isConsentGranted('ad_storage'),\n    ad_user_data: isConsentGranted('ad_user_data'),\n    ad_personalization: isConsentGranted('ad_personalization'),\n    analytics_storage: isConsentGranted('analytics_storage'),\n    functionality_storage: isConsentGranted('functionality_storage'),\n    personalization_storage: isConsentGranted('personalization_storage'),\n    security_storage: isConsentGranted('security_storage'),\n  };\n  return eventData;\n}\n\nfunction getEventName(data) {\n  const eventName = 'page_view';\n\n  if (data.event_type === 'standard') {\n    return data.event_name_standard ? data.event_name_standard : eventName;\n  }\n\n  if (data.event_type === 'custom') {\n    return data.event_name_custom ? data.event_name_custom : eventName;\n  }\n\n  return eventName;\n}\n\nfunction getCustomData(data, dtagLoaded) {\n  let dataToStore = [];\n  let customData = userAndCustomData;\n\n  for (let dataKey in customData) {\n    let dataValue = customData[dataKey].value;\n    let dataTransformation = customData[dataKey].transformation;\n\n    if (dataValue) {\n      if (dataTransformation === 'trim') {\n        dataValue = makeString(dataValue);\n        dataValue = dataValue.trim();\n      }\n\n      if (dataTransformation === 'to_lower_case') {\n        dataValue = makeString(dataValue);\n        dataValue = dataValue.trim().toLowerCase();\n      }\n\n      if (dataTransformation === 'base64') {\n        dataValue = makeString(dataValue);\n        dataValue = toBase64(dataValue);\n      }\n\n      if (dtagLoaded && dataTransformation === 'md5') {\n        dataValue = makeString(dataValue);\n        dataValue = callInWindow('dataTagMD5', dataValue.trim().toLowerCase());\n      }\n\n      if (dtagLoaded && dataTransformation === 'sha256base64') {\n        dataValue = makeString(dataValue);\n        dataValue = callInWindow(\n          'dataTag256',\n          dataValue.trim().toLowerCase(),\n          'B64'\n        );\n      }\n\n      if (dtagLoaded && dataTransformation === 'sha256hex') {\n        dataValue = makeString(dataValue);\n        dataValue = callInWindow(\n          'dataTag256',\n          dataValue.trim().toLowerCase(),\n          'HEX'\n        );\n      }\n\n      if (customData[dataKey].store && customData[dataKey].store !== 'none') {\n        dataToStore.push({\n          store: customData[dataKey].store,\n          name: customData[dataKey].name,\n          value: dataValue,\n        });\n      }\n\n      customData[dataKey].value = dataValue;\n    }\n  }\n\n  if (dataToStore.length !== 0) {\n    storeData(dataToStore);\n  }\n\n  return customData;\n}\n\nfunction storeData(dataToStore) {\n  let dataToStoreCookieResult = {};\n  let dataToStoreLocalStorageResult = {};\n  let dataToStoreCookie = getCookieValues('stape')[0];\n\n  if (dataToStoreCookie) {\n    dataToStoreCookie = JSON.parse(dataToStoreCookie);\n\n    if (dataToStoreCookie) {\n      for (let attrName in dataToStoreCookie) {\n        if (dataToStoreCookie[attrName])\n          dataToStoreCookieResult[attrName] = dataToStoreCookie[attrName];\n      }\n    }\n  }\n\n  if (localStorage) {\n    let dataToStoreLocalStorage = localStorage.getItem('stape');\n\n    if (dataToStoreLocalStorage) {\n      dataToStoreLocalStorage = JSON.parse(dataToStoreLocalStorage);\n\n      if (dataToStoreLocalStorage) {\n        for (let attrName in dataToStoreLocalStorage) {\n          if (dataToStoreLocalStorage[attrName])\n            dataToStoreLocalStorageResult[attrName] =\n              dataToStoreLocalStorage[attrName];\n        }\n      }\n    }\n  }\n\n  for (let attrName in dataToStore) {\n    if (dataToStore[attrName].value) {\n      if (\n        dataToStore[attrName].store === 'all' ||\n        dataToStore[attrName].store === 'localStorage'\n      ) {\n        dataToStoreLocalStorageResult[dataToStore[attrName].name] =\n          dataToStore[attrName].value;\n      }\n\n      if (\n        dataToStore[attrName].store === 'all' ||\n        dataToStore[attrName].store === 'cookies'\n      ) {\n        dataToStoreCookieResult[dataToStore[attrName].name] =\n          dataToStore[attrName].value;\n      }\n    }\n  }\n\n  if (localStorage && getObjectLength(dataToStoreLocalStorageResult) !== 0) {\n    localStorage.setItem(\n      'stape',\n      JSON.stringify(dataToStoreLocalStorageResult)\n    );\n  }\n\n  if (getObjectLength(dataToStoreCookieResult) !== 0) {\n    setCookie('stape', JSON.stringify(dataToStoreCookieResult), {\n      secure: true,\n      domain: 'auto',\n      path: '/',\n    });\n  }\n}\n\nfunction getObjectLength(object) {\n  let length = 0;\n\n  for (let key in object) {\n    if (object.hasOwnProperty(key)) {\n      ++length;\n    }\n  }\n  return length;\n}\n\nfunction determinateRequestType() {\n  if (data.request_type !== 'auto') {\n    return data.request_type;\n  }\n\n  if (data.add_data_layer) {\n    return 'post';\n  }\n\n  if (data.dataLayerEventPush) {\n    return 'post';\n  }\n\n  if (data.richsstsse) {\n    return 'post';\n  }\n\n  const isHashingEnabled = userAndCustomData.some(\n    (item) =>\n      item.transformation === 'md5' ||\n      item.transformation === 'sha256base64' ||\n      item.transformation === 'sha256hex'\n  );\n\n  if (isHashingEnabled) return 'post';\n\n  const userAndCustomDataLength = makeNumber(\n    JSON.stringify(userAndCustomData).length\n  );\n  return userAndCustomDataLength > 1500 ? 'post' : 'get';\n}\n\nfunction getUserAndCustomDataArray() {\n  let userAndCustomDataArray = [];\n\n  if (data.custom_data && data.custom_data.length) {\n    userAndCustomDataArray = data.custom_data;\n  }\n\n  if (data.user_data && data.user_data.length) {\n    for (let userDataKey in data.user_data) {\n      userAndCustomDataArray.push(data.user_data[userDataKey]);\n    }\n  }\n  return userAndCustomDataArray;\n}\n\nfunction addCommonCookie(eventData) {\n  const cookieNames = [\n    // FB cookies\n    '_fbc',\n    '_fbp',\n    '_gtmeec',\n    // TikTok cookies\n    'ttclid',\n    '_ttp',\n    // Pinterest cookies\n    '_epik',\n    // Snapchat cookies\n    '_scid',\n    '_scclid',\n    // Taboola cookies\n    'taboola_cid',\n    // Awin cookies\n    'awin_awc',\n    'awin_source',\n    // Rakuten cookies\n    'rakuten_site_id',\n    'rakuten_time_entered',\n    'rakuten_ran_mid',\n    'rakuten_ran_eaid',\n    'rakuten_ran_site_id',\n    // Klaviyo cookies\n    'stape_klaviyo_email',\n    'stape_klaviyo_kx',\n    'stape_klaviyo_viewed_items',\n    // Outbrain cookies\n    'outbrain_cid',\n  ];\n  let commonCookie = null;\n\n  for (var i = 0; i < cookieNames.length; i++) {\n    const name = cookieNames[i];\n    var cookie = getCookieValues(name)[0];\n    if (cookie) {\n      commonCookie = commonCookie || {};\n      commonCookie[name] = cookie;\n    }\n  }\n  if (commonCookie) {\n    eventData.common_cookie = commonCookie;\n  }\n  return eventData;\n}\n\n\n___WEB_PERMISSIONS___\n\n[\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"access_globals\",\n        \"versionId\": \"1\"\n      },\n      \"param\": [\n        {\n          \"key\": \"keys\",\n          \"value\": {\n            \"type\": 2,\n            \"listItem\": [\n              {\n                \"type\": 3,\n                \"mapKey\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"key\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"read\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"write\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"execute\"\n                  }\n                ],\n                \"mapValue\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"dataLayer\"\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": true\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": false\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": false\n                  }\n                ]\n              },\n              {\n                \"type\": 3,\n                \"mapKey\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"key\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"read\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"write\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"execute\"\n                  }\n                ],\n                \"mapValue\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"dataTagSendData\"\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": true\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": true\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": true\n                  }\n                ]\n              },\n              {\n                \"type\": 3,\n                \"mapKey\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"key\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"read\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"write\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"execute\"\n                  }\n                ],\n                \"mapValue\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"dataTagGetData\"\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": true\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": true\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": true\n                  }\n                ]\n              },\n              {\n                \"type\": 3,\n                \"mapKey\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"key\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"read\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"write\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"execute\"\n                  }\n                ],\n                \"mapValue\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"dataTagData\"\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": true\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": true\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": false\n                  }\n                ]\n              },\n              {\n                \"type\": 3,\n                \"mapKey\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"key\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"read\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"write\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"execute\"\n                  }\n                ],\n                \"mapValue\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"dataTagMD5\"\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": true\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": true\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": true\n                  }\n                ]\n              },\n              {\n                \"type\": 3,\n                \"mapKey\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"key\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"read\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"write\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"execute\"\n                  }\n                ],\n                \"mapValue\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"dataTag256\"\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": true\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": true\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": true\n                  }\n                ]\n              }\n            ]\n          }\n        }\n      ]\n    },\n    \"clientAnnotations\": {\n      \"isEditedByUser\": true\n    },\n    \"isRequired\": true\n  },\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"get_referrer\",\n        \"versionId\": \"1\"\n      },\n      \"param\": [\n        {\n          \"key\": \"urlParts\",\n          \"value\": {\n            \"type\": 1,\n            \"string\": \"any\"\n          }\n        },\n        {\n          \"key\": \"queriesAllowed\",\n          \"value\": {\n            \"type\": 1,\n            \"string\": \"any\"\n          }\n        }\n      ]\n    },\n    \"clientAnnotations\": {\n      \"isEditedByUser\": true\n    },\n    \"isRequired\": true\n  },\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"read_data_layer\",\n        \"versionId\": \"1\"\n      },\n      \"param\": [\n        {\n          \"key\": \"allowedKeys\",\n          \"value\": {\n            \"type\": 1,\n            \"string\": \"specific\"\n          }\n        },\n        {\n          \"key\": \"keyPatterns\",\n          \"value\": {\n            \"type\": 2,\n            \"listItem\": [\n              {\n                \"type\": 1,\n                \"string\": \"gtm.uniqueEventId\"\n              },\n              {\n                \"type\": 1,\n                \"string\": \"gtm.start\"\n              }\n            ]\n          }\n        }\n      ]\n    },\n    \"clientAnnotations\": {\n      \"isEditedByUser\": true\n    },\n    \"isRequired\": true\n  },\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"read_title\",\n        \"versionId\": \"1\"\n      },\n      \"param\": []\n    },\n    \"isRequired\": true\n  },\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"get_url\",\n        \"versionId\": \"1\"\n      },\n      \"param\": [\n        {\n          \"key\": \"urlParts\",\n          \"value\": {\n            \"type\": 1,\n            \"string\": \"any\"\n          }\n        },\n        {\n          \"key\": \"queriesAllowed\",\n          \"value\": {\n            \"type\": 1,\n            \"string\": \"any\"\n          }\n        }\n      ]\n    },\n    \"clientAnnotations\": {\n      \"isEditedByUser\": true\n    },\n    \"isRequired\": true\n  },\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"inject_script\",\n        \"versionId\": \"1\"\n      },\n      \"param\": [\n        {\n          \"key\": \"urls\",\n          \"value\": {\n            \"type\": 2,\n            \"listItem\": [\n              {\n                \"type\": 1,\n                \"string\": \"https://stapecdn.com/dtag/*\"\n              }\n            ]\n          }\n        }\n      ]\n    },\n    \"clientAnnotations\": {\n      \"isEditedByUser\": true\n    },\n    \"isRequired\": true\n  },\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"access_local_storage\",\n        \"versionId\": \"1\"\n      },\n      \"param\": [\n        {\n          \"key\": \"keys\",\n          \"value\": {\n            \"type\": 2,\n            \"listItem\": [\n              {\n                \"type\": 3,\n                \"mapKey\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"key\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"read\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"write\"\n                  }\n                ],\n                \"mapValue\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"stape\"\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": true\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": true\n                  }\n                ]\n              }\n            ]\n          }\n        }\n      ]\n    },\n    \"clientAnnotations\": {\n      \"isEditedByUser\": true\n    },\n    \"isRequired\": true\n  },\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"read_character_set\",\n        \"versionId\": \"1\"\n      },\n      \"param\": []\n    },\n    \"isRequired\": true\n  },\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"send_pixel\",\n        \"versionId\": \"1\"\n      },\n      \"param\": [\n        {\n          \"key\": \"allowedUrls\",\n          \"value\": {\n            \"type\": 1,\n            \"string\": \"any\"\n          }\n        }\n      ]\n    },\n    \"clientAnnotations\": {\n      \"isEditedByUser\": true\n    },\n    \"isRequired\": true\n  },\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"get_cookies\",\n        \"versionId\": \"1\"\n      },\n      \"param\": [\n        {\n          \"key\": \"cookieAccess\",\n          \"value\": {\n            \"type\": 1,\n            \"string\": \"specific\"\n          }\n        },\n        {\n          \"key\": \"cookieNames\",\n          \"value\": {\n            \"type\": 2,\n            \"listItem\": [\n              {\n                \"type\": 1,\n                \"string\": \"stape\"\n              },\n              {\n                \"type\": 1,\n                \"string\": \"_fbc\"\n              },\n              {\n                \"type\": 1,\n                \"string\": \"_fbp\"\n              },\n              {\n                \"type\": 1,\n                \"string\": \"_gtmeec\"\n              },\n              {\n                \"type\": 1,\n                \"string\": \"ttclid\"\n              },\n              {\n                \"type\": 1,\n                \"string\": \"_ttp\"\n              },\n              {\n                \"type\": 1,\n                \"string\": \"_epik\"\n              },\n              {\n                \"type\": 1,\n                \"string\": \"_scid\"\n              },\n              {\n                \"type\": 1,\n                \"string\": \"_scclid\"\n              },\n              {\n                \"type\": 1,\n                \"string\": \"taboola_cid\"\n              },\n              {\n                \"type\": 1,\n                \"string\": \"awin_awc\"\n              },\n              {\n                \"type\": 1,\n                \"string\": \"awin_source\"\n              },\n              {\n                \"type\": 1,\n                \"string\": \"rakuten_site_id\"\n              },\n              {\n                \"type\": 1,\n                \"string\": \"rakuten_time_entered\"\n              },\n              {\n                \"type\": 1,\n                \"string\": \"rakuten_ran_mid\"\n              },\n              {\n                \"type\": 1,\n                \"string\": \"rakuten_ran_eaid\"\n              },\n              {\n                \"type\": 1,\n                \"string\": \"rakuten_ran_site_id\"\n              },\n              {\n                \"type\": 1,\n                \"string\": \"stape_klaviyo_email\"\n              },\n              {\n                \"type\": 1,\n                \"string\": \"stape_klaviyo_kx\"\n              },\n              {\n                \"type\": 1,\n                \"string\": \"stape_klaviyo_viewed_items\"\n              },\n              {\n                \"type\": 1,\n                \"string\": \"outbrain_cid\"\n              }\n            ]\n          }\n        }\n      ]\n    },\n    \"clientAnnotations\": {\n      \"isEditedByUser\": true\n    },\n    \"isRequired\": true\n  },\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"set_cookies\",\n        \"versionId\": \"1\"\n      },\n      \"param\": [\n        {\n          \"key\": \"allowedCookies\",\n          \"value\": {\n            \"type\": 2,\n            \"listItem\": [\n              {\n                \"type\": 3,\n                \"mapKey\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"name\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"domain\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"path\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"secure\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"session\"\n                  }\n                ],\n                \"mapValue\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"stape\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"*\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"*\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"any\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"any\"\n                  }\n                ]\n              }\n            ]\n          }\n        }\n      ]\n    },\n    \"clientAnnotations\": {\n      \"isEditedByUser\": true\n    },\n    \"isRequired\": true\n  },\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"read_container_data\",\n        \"versionId\": \"1\"\n      },\n      \"param\": []\n    },\n    \"isRequired\": true\n  },\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"access_consent\",\n        \"versionId\": \"1\"\n      },\n      \"param\": [\n        {\n          \"key\": \"consentTypes\",\n          \"value\": {\n            \"type\": 2,\n            \"listItem\": [\n              {\n                \"type\": 3,\n                \"mapKey\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"consentType\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"read\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"write\"\n                  }\n                ],\n                \"mapValue\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"ad_storage\"\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": true\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": false\n                  }\n                ]\n              },\n              {\n                \"type\": 3,\n                \"mapKey\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"consentType\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"read\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"write\"\n                  }\n                ],\n                \"mapValue\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"ad_user_data\"\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": true\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": false\n                  }\n                ]\n              },\n              {\n                \"type\": 3,\n                \"mapKey\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"consentType\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"read\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"write\"\n                  }\n                ],\n                \"mapValue\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"ad_personalization\"\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": true\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": false\n                  }\n                ]\n              },\n              {\n                \"type\": 3,\n                \"mapKey\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"consentType\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"read\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"write\"\n                  }\n                ],\n                \"mapValue\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"analytics_storage\"\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": true\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": false\n                  }\n                ]\n              },\n              {\n                \"type\": 3,\n                \"mapKey\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"consentType\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"read\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"write\"\n                  }\n                ],\n                \"mapValue\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"functionality_storage\"\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": true\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": false\n                  }\n                ]\n              },\n              {\n                \"type\": 3,\n                \"mapKey\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"consentType\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"read\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"write\"\n                  }\n                ],\n                \"mapValue\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"personalization_storage\"\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": true\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": false\n                  }\n                ]\n              },\n              {\n                \"type\": 3,\n                \"mapKey\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"consentType\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"read\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"write\"\n                  }\n                ],\n                \"mapValue\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"security_storage\"\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": true\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": false\n                  }\n                ]\n              }\n            ]\n          }\n        }\n      ]\n    },\n    \"clientAnnotations\": {\n      \"isEditedByUser\": true\n    },\n    \"isRequired\": true\n  }\n]\n\n\n___TESTS___\n\nscenarios: []\n\n\n___NOTES___\n\nCreated on 21/03/2021, 11:26:46\n\n\n",
                "galleryReference": {
                    "host": "github.com",
                    "owner": "stape-io",
                    "repository": "data-tag",
                    "version": "9bcc3f21b2f605bc5c9fb4adac6b99785126db45",
                    "signature": "c737b02cf69eaa623cd1d14d7b7abd17477103f8fd13e371cb33b1adff5d82c6"
                }
            },
            {
                "accountId": "6246124678",
                "containerId": "193445853",
                "templateId": "255",
                "name": "Unique Event ID",
                "fingerprint": "1737718470801",
                "templateData": "___TERMS_OF_SERVICE___\n\nBy creating or modifying this file you agree to Google Tag Manager's Community\nTemplate Gallery Developer Terms of Service available at\nhttps://developers.google.com/tag-manager/gallery-tos (or such other URL as\nGoogle may provide), as modified from time to time.\n\n\n___INFO___\n\n{\n  \"type\": \"MACRO\",\n  \"id\": \"cvt_temp_public_id\",\n  \"version\": 1,\n  \"securityGroups\": [],\n  \"displayName\": \"Unique Event ID\",\n  \"description\": \"Generates unique event id\",\n  \"categories\": [\n    \"UTILITY\"\n  ],\n  \"containerContexts\": [\n    \"WEB\"\n  ],\n  \"brand\": {\n    \"displayName\": \"stape-io\",\n    \"id\": \"github.com_stape-io\"\n  }\n}\n\n\n___TEMPLATE_PARAMETERS___\n\n[]\n\n\n___SANDBOXED_JS_FOR_WEB_TEMPLATE___\n\nconst copyFromDataLayer = require('copyFromDataLayer');\nconst setInWindow = require('setInWindow');\nconst copyFromWindow = require('copyFromWindow');\nconst getTimestampMillis = require('getTimestampMillis');\nconst generateRandom = require('generateRandom');\n\n\nreturn getBrowserId() + '_' + getPageLoadId() + getGtmUniqueEventId();\n\nfunction getGtmUniqueEventId() {\n    let gtmId = copyFromDataLayer('gtm.uniqueEventId')  || 0;\n    return gtmId >= 0 ? gtmId : '00';\n}\n\nfunction getBrowserId() {\n    let gtmBrowserId =  copyFromWindow('gtmBrowserId');\n\n    if (!gtmBrowserId) {\n        gtmBrowserId = getTimestampMillis() + generateRandom(100000, 999999);\n        setInWindow('gtmBrowserId', gtmBrowserId, false);\n    }\n\n    return gtmBrowserId;\n}\n\nfunction getPageLoadId() {\n  let eventId = copyFromWindow('gtmPageLoadId');\n\n  if (!eventId) {\n    eventId = getTimestampMillis() + generateRandom(100000, 999999);\n    setInWindow('gtmPageLoadId', eventId, false);\n  }\n\n  return eventId;\n}\n\n\n___WEB_PERMISSIONS___\n\n[\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"read_data_layer\",\n        \"versionId\": \"1\"\n      },\n      \"param\": [\n        {\n          \"key\": \"allowedKeys\",\n          \"value\": {\n            \"type\": 1,\n            \"string\": \"specific\"\n          }\n        },\n        {\n          \"key\": \"keyPatterns\",\n          \"value\": {\n            \"type\": 2,\n            \"listItem\": [\n              {\n                \"type\": 1,\n                \"string\": \"gtm.uniqueEventId\"\n              }\n            ]\n          }\n        }\n      ]\n    },\n    \"clientAnnotations\": {\n      \"isEditedByUser\": true\n    },\n    \"isRequired\": true\n  },\n  {\n    \"instance\": {\n      \"key\": {\n        \"publicId\": \"access_globals\",\n        \"versionId\": \"1\"\n      },\n      \"param\": [\n        {\n          \"key\": \"keys\",\n          \"value\": {\n            \"type\": 2,\n            \"listItem\": [\n              {\n                \"type\": 3,\n                \"mapKey\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"key\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"read\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"write\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"execute\"\n                  }\n                ],\n                \"mapValue\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"gtmPageLoadId\"\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": true\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": true\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": false\n                  }\n                ]\n              },\n              {\n                \"type\": 3,\n                \"mapKey\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"key\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"read\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"write\"\n                  },\n                  {\n                    \"type\": 1,\n                    \"string\": \"execute\"\n                  }\n                ],\n                \"mapValue\": [\n                  {\n                    \"type\": 1,\n                    \"string\": \"gtmBrowserId\"\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": true\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": true\n                  },\n                  {\n                    \"type\": 8,\n                    \"boolean\": false\n                  }\n                ]\n              }\n            ]\n          }\n        }\n      ]\n    },\n    \"clientAnnotations\": {\n      \"isEditedByUser\": true\n    },\n    \"isRequired\": true\n  }\n]\n\n\n___TESTS___\n\nscenarios: []\n\n\n___NOTES___\n\nCreated on 11/03/2021, 11:05:32\n\n\n",
                "galleryReference": {
                    "host": "github.com",
                    "owner": "stape-io",
                    "repository": "unique-event-id-variable",
                    "version": "76498f16f1954b0286640d19eb6a1ddf2909e183",
                    "signature": "5db6da902483d707bdbc159bd82985f8d41e38d1f6f2609d774407279284a8d8"
                }
            }
        ]
    }
}